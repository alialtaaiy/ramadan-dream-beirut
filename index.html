<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ØªÙ‚ÙˆÙŠÙ… Ø±Ù…Ø¶Ø§Ù† â€” Ø­Ù„Ù… Ø¨ÙŠØ±ÙˆØª</title>
  <link rel="icon" href="logo.png">

  <style>
    :root{
      --bg:#071826;
      --gold:#f5c400;
      --text:#eaf2ff;
      --muted:#b9c7da;
      --line:rgba(255,255,255,.12);
      --shadow: 0 18px 50px rgba(0,0,0,.35);
      --radius:18px;
    }

    /* Social icons (hover + glow + press + fade) */
    .socialRow{
      margin-top: 14px;
      display:flex;
      justify-content:center;
      gap: 14px;
      flex-wrap: wrap;
    }
    .socialIcon{
      width: 56px;
      height: 56px;
      border-radius: 999px;
      display:grid;
      place-items:center;
      text-decoration:none;
      color: var(--gold);
      background: rgba(0,0,0,.24);
      border: 1px solid rgba(245,196,0,.38);
      box-shadow:
        0 12px 26px rgba(0,0,0,.28),
        0 0 0 0 rgba(245,196,0,0);
      transition:
        transform .18s ease,
        box-shadow .22s ease,
        background .22s ease,
        border-color .22s ease,
        filter .22s ease;
      will-change: transform, box-shadow;
      position: relative;
      overflow: hidden;
    }
    .socialIcon::before{
      content:"";
      position:absolute;
      inset:-40%;
      background: radial-gradient(circle at 30% 30%, rgba(245,196,0,.25), transparent 55%);
      transform: translateX(-30%) translateY(-15%) rotate(8deg);
      opacity: 0;
      transition: opacity .22s ease;
      pointer-events:none;
    }
    .socialIcon:hover{
      background: rgba(245,196,0,.10);
      border-color: rgba(245,196,0,.55);
      transform: translateY(-2px) scale(1.03);
      box-shadow:
        0 16px 34px rgba(0,0,0,.34),
        0 0 22px rgba(245,196,0,.22),
        0 0 0 6px rgba(245,196,0,.06);
      filter: saturate(1.08);
    }
    .socialIcon:hover::before{ opacity: 1; }
    .socialIcon:active{
      transform: translateY(0px) scale(.98);
      box-shadow:
        0 10px 22px rgba(0,0,0,.26),
        0 0 14px rgba(245,196,0,.16),
        0 0 0 4px rgba(245,196,0,.05);
    }
    .socialIcon:focus-visible{
      outline: none;
      box-shadow:
        0 16px 34px rgba(0,0,0,.34),
        0 0 0 6px rgba(245,196,0,.14),
        0 0 26px rgba(245,196,0,.22);
    }

    .fadeIn{
      opacity: 0;
      transform: translateY(10px);
      animation: fadeUp .55s ease forwards;
    }
    .fadeIn.d2{ animation-delay: .08s; }
    .fadeIn.d3{ animation-delay: .16s; }
    @keyframes fadeUp{
      to{ opacity:1; transform: translateY(0); }
    }

    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Tahoma, Arial, sans-serif;
      background: radial-gradient(1200px 600px at 50% 0%, #0e3a55 0%, var(--bg) 55%);
      color:var(--text);
      padding: 18px;
    }
    .wrap{ max-width: 980px; margin: 0 auto; }

    .top{
      display:flex; align-items:center; justify-content:space-between;
      gap:14px; margin-bottom: 14px; flex-wrap: wrap;
    }
    .brand{ display:flex; align-items:center; gap:14px; }
    .logo{
      width:74px; height:74px; border-radius:18px;
      background: linear-gradient(135deg, rgba(245,196,0,.25), rgba(255,255,255,.06));
      display:flex; align-items:center; justify-content:center;
      overflow:hidden; border:1px solid var(--line);
      flex: 0 0 auto;
    }
    .logo img{ width:100%; height:100%; object-fit:cover; display:block; }
    .title h1{ margin:0; font-size: 26px; color: var(--gold); }
    .title p{ margin:6px 0 0; color: var(--muted); font-size: 14px; }

    .actions{ display:flex; gap:10px; align-items:center; flex-wrap: wrap; }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding: 7px 11px;
      border-radius: 999px;
      background: rgba(245,196,0,.10);
      border: 1px solid rgba(245,196,0,.30);
      color: var(--gold);
      font-size: 12px;
      white-space:nowrap;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 14px;
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid var(--line);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      overflow:hidden;
    }
    .cardHeader{
      padding: 14px 16px;
      background: rgba(0,0,0,.18);
      border-bottom: 1px solid var(--line);
      display:flex; align-items:center; justify-content:space-between; gap: 10px;
    }
    .cardHeader h2{
      margin:0; font-size: 16px; color: var(--gold);
      display:flex; align-items:center; gap:8px;
    }
    .cardBody{ padding: 16px; }

    .big{
      background: linear-gradient(180deg, rgba(245,196,0,.14), rgba(0,0,0,.20));
      border: 1px solid rgba(245,196,0,.30);
      border-radius: 16px;
      padding: 14px;
      display:grid;
      gap: 8px;
    }
    .big .k{ color: var(--muted); font-size: 12px; }
    .big .v{ font-size: 18px; font-weight: 900; }
    .big .vGold{ color: var(--gold); }

    .times{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
      margin-top: 12px;
    }
    @media (max-width: 720px){
      .times{ grid-template-columns: 1fr 1fr; }
    }
    .t{
      background: rgba(0,0,0,.22);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 12px;
    }
    .t .name{ color: var(--muted); font-size: 12px; }
    .t .val{ font-size: 16px; font-weight: 900; margin-top: 6px; direction:ltr; text-align:left; }

    .btn{
      width:auto;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(245,196,0,.35);
      background: rgba(245,196,0,.10);
      color: var(--gold);
      font-weight: 900;
      cursor:pointer;
      user-select:none;
    }
    .btn:hover{ background: rgba(245,196,0,.14); }

    /* Ø¯Ø¹Ø§Ø¡ Ø§Ù„ÙŠÙˆÙ… */
    .dua{
      background: rgba(0,0,0,.22);
      border: 1px solid rgba(245,196,0,.25);
      border-radius: 16px;
      padding: 14px;
      margin-top: 12px;
      line-height: 1.9;
      text-align:right;
    }
    .dua .hd{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      margin-bottom: 10px;
    }
    .dua .hd .t{ color: var(--gold); font-weight: 900; }
    .dua .text{ color: var(--text); font-weight: 650; font-size: 14px; }
    .dua .src{ color: var(--muted); font-size: 12px; margin-top: 8px; }

    /* Slider (Ù…Ø³ØªÙ…Ø± ÙˆØºÙŠØ± Ù…Ù†Ù‚Ø·Ø¹) */
    .marquee{
      margin-top: 12px;
      border: 1px solid var(--line);
      border-radius: 16px;
      overflow:hidden;
      background: rgba(0,0,0,.18);
      padding: 10px;
    }
    .track{
      display:flex;
      gap: 10px;
      width: max-content;
      will-change: transform;
      animation: scroll 18s linear infinite;
    }
    .marquee:hover .track{ animation-play-state: paused; }

    @keyframes scroll{
      0%   { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }

    .pic{
      width: 220px;
      height: 125px;
      border-radius: 14px;
      overflow:hidden;
      border: 1px solid rgba(245,196,0,.18);
      box-shadow: 0 10px 22px rgba(0,0,0,.25);
      flex: 0 0 auto;
      background: rgba(255,255,255,.03);
    }
    .pic img{ width:100%; height:100%; object-fit:cover; display:block; }

    .noImages{
      padding: 14px;
      text-align:center;
      color: var(--muted);
      border: 1px dashed rgba(245,196,0,.35);
      border-radius: 14px;
      background: rgba(0,0,0,.18);
    }

    /* Footer phrase centered bold */
    .bless{
      margin-top: 14px;
      text-align:center;
      font-weight: 900;
      color: var(--text);
      line-height: 1.9;
    }
    .bless span{
      display:inline-block;
      padding: 10px 14px;
      border-radius: 14px;
      border: 1px solid rgba(245,196,0,.28);
      background: rgba(0,0,0,.18);
    }

    /* Settings modal */
    .modalWrap{
      position: fixed; inset: 0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:center; justify-content:center;
      padding: 16px;
      z-index: 999;
    }
    .modal{
      width: min(920px, 100%);
      max-height: 90vh;
      overflow:auto;
      border-radius: 18px;
      border: 1px solid var(--line);
      background: linear-gradient(180deg, rgba(14,42,63,.98), rgba(7,24,38,.98));
      box-shadow: var(--shadow);
    }
    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 520px){
      .row{ grid-template-columns: 1fr; }
      .socialRow{ gap: 12px; }
      .socialIcon{ width: 52px; height: 52px; }
      .socialIcon svg{ width: 20px; height: 20px; }
    }
    label{ display:block; font-size: 13px; color: var(--muted); margin-bottom: 6px; text-align:right; }
    select, input{
      width:100%;
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid var(--line);
      background: rgba(0,0,0,.22);
      color: var(--text);
      outline:none;
      font-size: 14px;
    }
    .hint{ font-size: 12px; color: var(--muted); margin-top: 6px; line-height:1.5; text-align:right; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div class="logo" title="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø·Ø¹Ù…">
          <img src="logo.png" alt="Logo"/>
        </div>
        <div class="title">
          <h1>ØªÙ‚ÙˆÙŠÙ… Ø±Ù…Ø¶Ø§Ù† â€” Ø­Ù„Ù… Ø¨ÙŠØ±ÙˆØª</h1>
          <p>Ù…Ø°Ø§Ù‚ Ø¨ÙŠØ±ÙˆØª Ø§Ù„Ø£ØµÙŠÙ„ Ø¨Ø£Ø·Ø¨Ø§Ù‚ ÙØ§Ø®Ø±Ø© ÙˆØ£Ø¬ÙˆØ§Ø¡ ØªØ£Ø®Ø°Ùƒ Ø¥Ù„Ù‰ Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ù…ØªÙˆØ³Ø· â€¢ Ø§Ù„Ø¯ÙˆØ§Ù… 24 Ø³Ø§Ø¹Ø©</p>
        </div>
      </div>

      <div class="actions">
        <button id="toggleSettings" class="btn">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
        <button id="btnToday" class="btn">Ø§Ù„ÙŠÙˆÙ…</button>
        <button id="btnRefreshTop" class="btn">ØªØ­Ø¯ÙŠØ«</button>
        <div class="pill" id="statusPill">Ø¬Ø§Ù‡Ø²</div>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="cardHeader">
          <h2>ğŸ•Œ Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„Ù…ÙˆØ§Ù‚ÙŠØª</h2>
          <div class="pill" id="cityPill">Ø¨ØºØ¯Ø§Ø¯</div>
        </div>

        <div class="cardBody">
          <div class="big">
            <div class="k">Ø§Ù„ÙŠÙˆÙ…</div>
            <div class="v" id="line1">â€”</div>
            <div class="k">Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ</div>
            <div class="v vGold" id="hijriLine">â€”</div>
            <div class="k">Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ</div>
            <div class="v" id="gregLine">â€”</div>
          </div>

          <div class="times">
            <div class="t"><div class="name">Ø§Ù„Ø¥Ù…Ø³Ø§Ùƒ</div><div class="val" id="imsak">â€”</div></div>
            <div class="t"><div class="name">Ø§Ù„ÙØ¬Ø±</div><div class="val" id="fajr">â€”</div></div>
            <div class="t"><div class="name">Ø§Ù„Ø´Ø±ÙˆÙ‚</div><div class="val" id="sunrise">â€”</div></div>
            <div class="t"><div class="name">Ø§Ù„Ø¸Ù‡Ø±</div><div class="val" id="dhuhr">â€”</div></div>
            <div class="t"><div class="name">Ø§Ù„Ø¹ØµØ±</div><div class="val" id="asr">â€”</div></div>
            <div class="t"><div class="name">Ø§Ù„Ù…ØºØ±Ø¨ (Ø§Ù„Ø¥ÙØ·Ø§Ø±)</div><div class="val" id="maghrib">â€”</div></div>
            <div class="t"><div class="name">Ø§Ù„Ø¹Ø´Ø§Ø¡</div><div class="val" id="isha">â€”</div></div>
          </div>

          <!-- Ø¯Ø¹Ø§Ø¡ Ø§Ù„ÙŠÙˆÙ… -->
          <div class="dua fadeIn">
            <div class="hd">
              <div class="t">ğŸ¤² Ø¯Ø¹Ø§Ø¡ Ø§Ù„ÙŠÙˆÙ…</div>
              <div class="pill" id="duaDayPill">â€”</div>
            </div>
            <div class="text" id="duaText">â€”</div>
            <div class="src">ÙŠØªØºÙŠØ± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙŠÙˆÙ…ÙŠØ§Ù‹</div>
          </div>

          <!-- Slider ØªØ­Øª Ø§Ù„Ø¯Ø¹Ø§Ø¡ -->
          <div class="marquee fadeIn d2" id="marqueeBox">
            <div class="track" id="imgTrack"></div>
          </div>
          <div id="noImagesBox" class="noImages" style="display:none;">
            Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØµÙˆØ± Ø¯Ø§Ø®Ù„ Ù…Ø¬Ù„Ø¯ <b>images</b>.<br>
            ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ ØµÙˆØ± Ù…Ø«Ù„: <b>1.jpg</b> Ø£Ùˆ <b>2.jpg</b> â€¦ Ø£Ùˆ Ø£Ø®Ø¨Ø±Ù†ÙŠ Ø¨Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„ØµÙˆØ± ÙˆØ³Ø£Ø«Ø¨ØªÙ‡Ø§ Ù„Ùƒ.
          </div>

          <!-- Social icons -->
          <div class="socialRow">
            <a class="socialIcon fadeIn" href="https://wa.me/9647701111722" target="_blank" rel="noopener" aria-label="WhatsApp">
              <svg viewBox="0 0 32 32" width="22" height="22" aria-hidden="true">
                <path fill="currentColor" d="M19.11 17.59c-.3-.15-1.77-.87-2.04-.97-.27-.1-.47-.15-.66.15-.2.3-.76.97-.93 1.17-.17.2-.34.22-.64.07-.3-.15-1.25-.46-2.38-1.47-.88-.78-1.48-1.75-1.65-2.05-.17-.3-.02-.46.13-.61.13-.13.3-.34.45-.51.15-.17.2-.3.3-.5.1-.2.05-.38-.03-.53-.08-.15-.66-1.6-.9-2.19-.24-.57-.48-.49-.66-.5h-.56c-.2 0-.53.08-.8.38-.27.3-1.05 1.03-1.05 2.5 0 1.47 1.07 2.9 1.22 3.1.15.2 2.1 3.2 5.08 4.49.71.31 1.27.5 1.7.64.71.23 1.36.2 1.87.12.57-.09 1.77-.72 2.02-1.42.25-.7.25-1.3.17-1.42-.08-.12-.27-.2-.57-.35z"/>
                <path fill="currentColor" d="M16.02 3C9.39 3 4 8.39 4 15.02c0 2.11.55 4.17 1.59 5.99L4 29l8.19-1.54a12 12 0 0 0 3.83.62C22.65 28.08 28 22.65 28 16.02 28 9.39 22.65 3 16.02 3zm0 22.03c-1.22 0-2.41-.23-3.54-.68l-.56-.22-4.85.91.92-4.73-.24-.6a9.95 9.95 0 0 1-1.02-4.39c0-5.53 4.5-10.03 10.03-10.03 5.53 0 10.03 4.5 10.03 10.03 0 5.53-4.5 10.03-10.03 10.03z"/>
              </svg>
            </a>

            <a class="socialIcon fadeIn d2" href="https://www.instagram.com/helem.rest?igsh=bHU3azE0dGdseGVv" target="_blank" rel="noopener" aria-label="Instagram">
              <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
                <path fill="currentColor" d="M7.5 2h9A5.5 5.5 0 0 1 22 7.5v9A5.5 5.5 0 0 1 16.5 22h-9A5.5 5.5 0 0 1 2 16.5v-9A5.5 5.5 0 0 1 7.5 2zm0 2A3.5 3.5 0 0 0 4 7.5v9A3.5 3.5 0 0 0 7.5 20h9a3.5 3.5 0 0 0 3.5-3.5v-9A3.5 3.5 0 0 0 16.5 4h-9z"/>
                <path fill="currentColor" d="M12 7a5 5 0 1 1 0 10 5 5 0 0 1 0-10zm0 2a3 3 0 1 0 0 6 3 3 0 0 0 0-6z"/>
                <path fill="currentColor" d="M17.75 6.25a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
              </svg>
            </a>

            <a class="socialIcon fadeIn d3" href="https://www.facebook.com/helemrest/" target="_blank" rel="noopener" aria-label="Facebook">
              <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
                <path fill="currentColor" d="M13.5 22v-8h2.7l.4-3h-3.1V9.1c0-.9.3-1.5 1.6-1.5h1.7V5c-.3 0-1.4-.1-2.7-.1-2.7 0-4.5 1.6-4.5 4.6V11H7v3h2.6v8h3.9z"/>
              </svg>
            </a>
          </div>

          <!-- Bless text -->
          <div class="bless fadeIn d3">
            <span>
              ØªÙ‚Ø¨Ù„ Ø§Ù„Ù„Ù‡ Ù…Ù†Ø§ ÙˆÙ…Ù†ÙƒÙ… ØµØ§Ù„Ø­ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„<br>
              ÙƒÙ„ Ø¹Ø§Ù… ÙˆØ£Ù†ØªÙ… Ø¨Ø£Ù„Ù Ø®ÙŠØ±
            </span>
          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- Settings modal -->
  <div class="modalWrap" id="settingsModal" aria-hidden="true">
    <div class="modal card">
      <div class="cardHeader">
        <h2>âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>
        <div style="display:flex; gap:10px;">
          <button id="btnSave" class="btn">Ø­ÙØ¸</button>
          <button id="btnClose" class="btn">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
      </div>
      <div class="cardBody">
        <div class="row">
          <div>
            <label>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</label>
            <select id="city">
              <option value="Baghdad">Ø¨ØºØ¯Ø§Ø¯</option>
              <option value="Basra">Ø§Ù„Ø¨ØµØ±Ø©</option>
            </select>
            <div class="hint">Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ: Ø¨ØºØ¯Ø§Ø¯ Ø«Ù… ÙŠØ­ÙØ¸ Ø¢Ø®Ø± Ø§Ø®ØªÙŠØ§Ø±.</div>
          </div>

          <div>
            <label>Ø§Ù„Ù…Ø°Ù‡Ø¨</label>
            <select id="sect">
              <option value="sunni">Ø§Ù„ÙˆÙ‚Ù Ø§Ù„Ø³Ù†ÙŠ</option>
              <option value="shia">Ø§Ù„ÙˆÙ‚Ù Ø§Ù„Ø´ÙŠØ¹ÙŠ</option>
            </select>
            <div class="hint">Ù‚Ø¯ ÙŠØ®ØªÙ„Ù ÙŠÙˆÙ… Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©ØŒ Ø¹Ù†Ø¯Ùƒ Ø§Ù„Ø´ÙŠØ¹ÙŠ ØºØ§Ù„Ø¨Ø§Ù‹ -1 ÙŠÙˆÙ….</div>
          </div>

          <div>
            <label>ØªØµØ­ÙŠØ­ (Â±1 ÙŠÙˆÙ…)</label>
            <select id="offset">
              <option value="0">0 (Ø¨Ø¯ÙˆÙ† ØªØµØ­ÙŠØ­)</option>
              <option value="1">+1 ÙŠÙˆÙ…</option>
              <option value="-1">-1 ÙŠÙˆÙ…</option>
            </select>
          </div>

          <div>
            <label>Ø§Ø®ØªØ± ØªØ§Ø±ÙŠØ® (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <input id="date" type="date"/>
            <div class="hint">Ø¥Ø°Ø§ ÙØ§Ø±ØºØŒ ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ….</div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
  const $ = (id) => document.getElementById(id);

  const DEFAULTS = {
    city: "Baghdad",
    sect: "sunni",
    sectOffsetSunni: 0,
    sectOffsetShia: -1,
    manualOffset: 0
  };

  function setStatus(t){
    const el = $("statusPill");
    if (el) el.textContent = t;
  }

  function loadSettings(){
    const saved = JSON.parse(localStorage.getItem("hb_ramadan_settings") || "null");
    $("city").value = (saved && saved.city) ? saved.city : DEFAULTS.city;
    $("sect").value = (saved && saved.sect) ? saved.sect : DEFAULTS.sect;
    $("offset").value = String((saved && typeof saved.manualOffset === "number") ? saved.manualOffset : DEFAULTS.manualOffset);
    if (saved?.date) $("date").value = saved.date;
  }

  function loadSettingsSafe(){
    try { loadSettings(); }
    catch(e){
      localStorage.removeItem("hb_ramadan_settings");
      loadSettings();
    }
  }

  function saveSettings(){
    const data = {
      city: $("city").value,
      sect: $("sect").value,
      manualOffset: parseInt($("offset").value,10) || 0,
      date: $("date").value || ""
    };
    localStorage.setItem("hb_ramadan_settings", JSON.stringify(data));
  }

  function getBaseDate(){
    const v = $("date").value;
    if (v) return new Date(v + "T00:00:00");
    const now = new Date();
    return new Date(now.getFullYear(), now.getMonth(), now.getDate());
  }

  function addDays(date, days){
    const d = new Date(date);
    d.setDate(d.getDate() + days);
    return d;
  }

  function getDisplayDate(){
    const base = getBaseDate();
    const sect = $("sect").value;
    const manualOffset = parseInt($("offset").value,10) || 0;
    const sectOffset = (sect === "shia") ? DEFAULTS.sectOffsetShia : DEFAULTS.sectOffsetSunni;
    return addDays(base, sectOffset + manualOffset);
  }

  function toAmPm(hhmm){
    if (!hhmm || hhmm === "â€”") return "â€”";
    const m = String(hhmm).match(/^(\d{1,2}):(\d{2})/);
    if(!m) return hhmm;
    let h = parseInt(m[1],10);
    const min = m[2];
    const ampm = (h >= 12) ? "PM" : "AM";
    h = h % 12; if (h === 0) h = 12;
    return `${h}:${min} ${ampm}`;
  }

  async function fetchTimingsAndDates(date, city){
    const d = String(date.getDate()).padStart(2,"0");
    const m = String(date.getMonth()+1).padStart(2,"0");
    const y = String(date.getFullYear());

    const url = `https://api.aladhan.com/v1/timingsByCity/${d}-${m}-${y}?city=${encodeURIComponent(city)}&country=Iraq&method=4`;
    const res = await fetch(url, { cache: "no-store" });
    const json = await res.json();
    const data = json?.data;

    const t = data?.timings || {};
    const clean = (v) => String(v || "").slice(0,5);

    const hijri = data?.date?.hijri;
    const greg  = data?.date?.gregorian;

    const hijriText = hijri
      ? `${hijri.day} ${hijri.month?.ar || hijri.month?.en || ""} ${hijri.year} Ù‡Ù€`
      : "â€”";

    const gregText = greg
      ? `${greg.day} ${greg.month?.en || ""} ${greg.year}`
      : "â€”";

    return {
      timings: {
        imsak: clean(t.Imsak || t.Fajr),
        fajr: clean(t.Fajr),
        sunrise: clean(t.Sunrise),
        dhuhr: clean(t.Dhuhr),
        asr: clean(t.Asr),
        maghrib: clean(t.Maghrib),
        isha: clean(t.Isha),
      },
      hijriText,
      gregText
    };
  }

  const DUAS = [
    "Ø§Ù„Ù„Ù‡Ù… Ø§Ø¬Ø¹Ù„Ù†Ø§ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ… Ù…Ù† Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„ÙŠÙ†ØŒ ÙˆØ§ØºÙØ± Ù„Ù†Ø§ ÙˆØ§Ø±Ø­Ù…Ù†Ø§ Ø¨Ø±Ø­Ù…ØªÙƒ ÙŠØ§ Ø£Ø±Ø­Ù… Ø§Ù„Ø±Ø§Ø­Ù…ÙŠÙ†.",
    "Ø§Ù„Ù„Ù‡Ù… Ø§Ø±Ø²Ù‚Ù†Ø§ ØµØ¯Ù‚ Ø§Ù„ØªÙˆØ¨Ø©ØŒ ÙˆØµÙØ§Ø¡ Ø§Ù„Ù‚Ù„Ø¨ØŒ ÙˆØ­Ø³Ù† Ø§Ù„Ø®Ø§ØªÙ…Ø©ØŒ ÙˆØ¨Ø§Ø±Ùƒ Ù„Ù†Ø§ ÙÙŠ Ø£Ø¹Ù…Ø§Ù„Ù†Ø§.",
    "Ø§Ù„Ù„Ù‡Ù… Ø§Ø¬Ø¹Ù„ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ… ÙØ±Ø¬Ø§Ù‹ Ù„ÙƒÙ„ Ù…Ù‡Ù…ÙˆÙ…ØŒ ÙˆØ´ÙØ§Ø¡Ù‹ Ù„ÙƒÙ„ Ù…Ø±ÙŠØ¶ØŒ ÙˆØ±Ø²Ù‚Ø§Ù‹ ÙˆØ§Ø³Ø¹Ø§Ù‹ Ù„Ù†Ø§ ÙˆÙ„Ø£Ù‡Ù„Ù†Ø§.",
    "Ø§Ù„Ù„Ù‡Ù… Ø§Ø¬Ø¹Ù„Ù†Ø§ Ù…Ù† Ø£Ù‡Ù„ Ø§Ù„Ù‚Ø±Ø¢Ù†ØŒ ÙˆÙˆÙÙ‚Ù†Ø§ Ù„Ù‚ÙŠØ§Ù… Ø§Ù„Ù„ÙŠÙ„ØŒ ÙˆØ§ØºØ³Ù„ Ù‚Ù„ÙˆØ¨Ù†Ø§ Ù…Ù† ÙƒÙ„ Ù‡Ù…Ù‘ ÙˆØ­Ø²Ù†.",
    "Ø§Ù„Ù„Ù‡Ù… ØªÙ‚Ø¨Ù„ ØµÙŠØ§Ù…Ù†Ø§ ÙˆÙ‚ÙŠØ§Ù…Ù†Ø§ØŒ ÙˆØ§Ù‡Ø¯Ù†Ø§ Ù„Ø£Ø­Ø³Ù† Ø§Ù„Ø£Ø®Ù„Ø§Ù‚ Ù„Ø§ ÙŠÙ‡Ø¯ÙŠ Ù„Ø£Ø­Ø³Ù†Ù‡Ø§ Ø¥Ù„Ø§ Ø£Ù†Øª.",
    "Ø§Ù„Ù„Ù‡Ù… Ø§Ø±Ø²Ù‚Ù†Ø§ Ø¨Ø±ÙƒØ© Ø§Ù„ÙˆÙ‚ØªØŒ ÙˆÙ†ÙˆØ± Ø§Ù„Ø¨ØµÙŠØ±Ø©ØŒ ÙˆØ±Ø§Ø­Ø© Ø§Ù„Ø¨Ø§Ù„ØŒ ÙˆØ³Ø¹Ø© Ø§Ù„Ø±Ø²Ù‚.",
    "Ø§Ù„Ù„Ù‡Ù… Ø§Ø¬Ø¹Ù„ Ù„Ù†Ø§ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ… Ø¯Ø¹ÙˆØ© Ù„Ø§ ØªÙØ±Ø¯ØŒ ÙˆØ§ÙØªØ­ Ù„Ù†Ø§ Ø£Ø¨ÙˆØ§Ø¨ Ø§Ù„Ø®ÙŠØ± Ù…Ù† Ø­ÙŠØ« Ù„Ø§ Ù†Ø­ØªØ³Ø¨.",
    "Ø§Ù„Ù„Ù‡Ù… Ø§Ø­ÙØ¸ Ø£Ù‡Ù„Ù†Ø§ ÙˆØ£ÙˆÙ„Ø§Ø¯Ù†Ø§ ÙˆØ¨Ù„Ø¯Ù†Ø§ØŒ ÙˆØ£Ø¯Ù… Ø¹Ù„ÙŠÙ†Ø§ Ø§Ù„Ø£Ù…Ù† ÙˆØ§Ù„Ø¹Ø§ÙÙŠØ© ÙˆØ§Ù„Ø³ØªØ±."
  ];
  function getDuaForDay(){
    const d = new Date();
    const key = d.getDate();
    return DUAS[(key - 1) % DUAS.length];
  }

  async function buildImageMarquee(){
    const track = $("imgTrack");
    const marquee = $("marqueeBox");
    const noBox = $("noImagesBox");
    if (!track || !marquee || !noBox) return;

    track.innerHTML = "";
    noBox.style.display = "none";
    marquee.style.display = "block";

    const candidates = [];
    for (let i=1;i<=30;i++){
      candidates.push(`images/${i}.jpg`, `images/${i}.jpeg`, `images/${i}.png`);
    }

    const exists = (src) => new Promise((resolve) => {
      const img = new Image();
      img.onload = () => resolve(true);
      img.onerror = () => resolve(false);
      img.src = src + `?v=${Date.now()}`;
    });

    const found = [];
    for (const src of candidates){
      if (found.length >= 6) break;
      // eslint-disable-next-line no-await-in-loop
      if (await exists(src)) found.push(src);
    }

    if (found.length === 0){
      marquee.style.display = "none";
      noBox.style.display = "block";
      return;
    }

    const full = found.concat(found);
    for (const src of full){
      const div = document.createElement("div");
      div.className = "pic";
      const img = document.createElement("img");
      img.src = src;
      img.alt = "Ø­Ù„Ù… Ø¨ÙŠØ±ÙˆØª";
      div.appendChild(img);
      track.appendChild(div);
    }
  }
function addMinutes(hhmm, mins){
  const m = String(hhmm).match(/^(\d{1,2}):(\d{2})/);
  if(!m) return hhmm;

  let h = parseInt(m[1],10);
  let mm = parseInt(m[2],10);

  let total = h*60 + mm + mins;
  total = (total + 1440) % 1440;

  const nh = String(Math.floor(total/60)).padStart(2,"0");
  const nm = String(total%60).padStart(2,"0");

  return `${nh}:${nm}`;
}

async function render(){
  async function render(){
    setStatus("ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«â€¦");

    const date = getDisplayDate();
    const city = $("city").value;
    const sect = $("sect").value;

    $("cityPill").textContent = (city === "Basra") ? "Ø§Ù„Ø¨ØµØ±Ø©" : "Ø¨ØºØ¯Ø§Ø¯";

    const sectLabel = (sect === "shia") ? "Ø§Ù„ÙˆÙ‚Ù Ø§Ù„Ø´ÙŠØ¹ÙŠ" : "Ø§Ù„ÙˆÙ‚Ù Ø§Ù„Ø³Ù†ÙŠ";
    $("line1").textContent = `Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠ (Ø­Ø³Ø¨ ${sectLabel})`;

    $("duaDayPill").textContent = "Ø§Ù„ÙŠÙˆÙ…";
    $("duaText").textContent = getDuaForDay();

    try{
      const out = await fetchTimingsAndDates(date, city);

      $("hijriLine").textContent = out.hijriText;
      $("gregLine").textContent  = out.gregText;

      const t = out.timings;
      $("imsak").textContent   = toAmPm(t.imsak);
      $("fajr").textContent    = toAmPm(t.fajr);
      $("sunrise").textContent = toAmPm(t.sunrise);
      $("dhuhr").textContent   = toAmPm(t.dhuhr);
      $("asr").textContent     = toAmPm(t.asr);
      $("maghrib").textContent = toAmPm(t.maghrib);
      $("isha").textContent    = toAmPm(t.isha);

      setStatus("ØªÙ… âœ…");
      setTimeout(()=>setStatus("Ø¬Ø§Ù‡Ø²"), 1200);
    }catch(e){
      ["imsak","fajr","sunrise","dhuhr","asr","maghrib","isha"].forEach(id=> $(id).textContent="â€”");
      setStatus("ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª");
    }
  }

  function openSettings(){
    $("settingsModal").style.display = "flex";
    $("settingsModal").setAttribute("aria-hidden","false");
  }
  function closeSettings(){
    $("settingsModal").style.display = "none";
    $("settingsModal").setAttribute("aria-hidden","true");
  }

  document.addEventListener("DOMContentLoaded", async () => {
    loadSettingsSafe();
    closeSettings();

    // Ø³Ù„Ø§ÙŠØ¯Ø±
    try { await buildImageMarquee(); } catch(e){}

    // Ù…ÙˆØ§Ù‚ÙŠØª: ØªØ´ØºÙŠÙ„ + Ø¥Ø¹Ø§Ø¯Ø© Ù…Ø­Ø§ÙˆÙ„Ø© Ø­ØªÙ‰ Ù…Ø§ ØªØ®ØªÙÙŠ Ø¨Ø¹Ø¯ refresh
    try { await render(); } catch(e){}
    setTimeout(() => { render(); }, 450);
  });

  // Ø¥Ø°Ø§ Ø§Ù„ØµÙØ­Ø© Ø±Ø¬Ø¹Øª Ù…Ù† Ø§Ù„ÙƒØ§Ø´
  window.addEventListener("pageshow", () => { render(); });

  // Events
  $("toggleSettings").addEventListener("click", openSettings);
  $("btnClose").addEventListener("click", closeSettings);
  $("settingsModal").addEventListener("click", (e)=>{
    if (e.target === $("settingsModal")) closeSettings();
  });

  $("btnSave").addEventListener("click", ()=>{ saveSettings(); closeSettings(); render(); setStatus("ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…"); });
  $("btnRefreshTop").addEventListener("click", render);
  $("btnToday").addEventListener("click", ()=>{ $("date").value=""; saveSettings(); render(); });

  $("city").addEventListener("change", render);
  $("sect").addEventListener("change", render);
  $("offset").addEventListener("change", render);
  $("date").addEventListener("change", render);
</script>
