<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ØªÙ‚ÙˆÙŠÙ… Ø±Ù…Ø¶Ø§Ù† â€“ Ø­Ù„Ù… Ø¨ÙŠØ±ÙˆØª</title>
  <style>
    :root{
      --bg:#071826;
      --panel:rgba(255,255,255,.06);
      --panel2:rgba(255,255,255,.09);
      --line:rgba(255,255,255,.12);
      --text:#eef6ff;
      --muted:#b6c7d6;
      --gold:#f5c400;
      --gold2:#ffdd55;
      --shadow:0 18px 55px rgba(0,0,0,.35);
      --radius:20px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Tahoma, Arial, sans-serif;
      background: radial-gradient(900px 600px at 15% 10%, rgba(245,196,0,.10), transparent 60%),
                  radial-gradient(900px 600px at 90% 15%, rgba(0,255,255,.06), transparent 65%),
                  var(--bg);
      color:var(--text);
      min-height:100vh;
    }
    a{color:inherit}
    .wrap{
      max-width:1100px;
      margin:0 auto;
      padding:18px 14px 26px;
    }
    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:14px;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width:0;
    }
    .logo{
      width:56px;height:56px;border-radius:16px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(245,196,0,.25);
      box-shadow:0 12px 30px rgba(0,0,0,.25);
      overflow:hidden;
      flex:0 0 auto;
    }
    .logo img{width:100%;height:100%;object-fit:cover;display:block}
    .titles{min-width:0}
    .titles h1{
      margin:0;
      font-size:22px;
      line-height:1.2;
      color:var(--gold);
      letter-spacing:.2px;
      text-shadow:0 0 16px rgba(245,196,0,.18);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .titles p{
      margin:4px 0 0;
      color:var(--muted);
      font-size:13.5px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.08fr .92fr;
      gap:14px;
      align-items:start;
    }
    @media (max-width: 920px){
      .grid{grid-template-columns:1fr}
    }

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.04));
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .cardHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:14px 14px 10px;
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .cardHead h2{
      margin:0;
      font-size:16px;
      color:var(--gold);
      display:flex;
      align-items:center;
      gap:8px;
    }
    .pill{
      padding:7px 10px;
      border-radius:999px;
      border:1px solid rgba(245,196,0,.28);
      background:rgba(245,196,0,.10);
      color:var(--gold2);
      font-size:12px;
      user-select:none;
    }
    .bodyPad{padding:14px}

    .todayBox{
      background:linear-gradient(135deg, rgba(245,196,0,.09), rgba(255,255,255,.03));
      border:1px solid rgba(245,196,0,.22);
      border-radius:18px;
      padding:14px;
      margin-bottom:12px;
    }
    .todayTitle{
      margin:0 0 6px;
      font-size:15px;
      font-weight:800;
    }
    .todayLine{
      margin:4px 0;
      color:var(--muted);
      font-size:13.5px;
    }
    .todayLine strong{color:var(--text)}
    .bigHijri{
      margin:8px 0 0;
      font-size:17px;
      font-weight:900;
      color:var(--gold2);
    }

    .timesGrid{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap:10px;
    }
    @media (max-width:520px){
      .timesGrid{grid-template-columns: repeat(2, minmax(0, 1fr));}
    }
    .timeCard{
      background:rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.10);
      border-radius:18px;
      padding:12px 10px;
      text-align:center;
      transition:transform .2s ease, box-shadow .2s ease, border-color .2s ease;
    }
    .timeCard:hover{
      transform:translateY(-2px);
      border-color:rgba(245,196,0,.28);
      box-shadow:0 12px 35px rgba(0,0,0,.25);
    }
    .timeName{
      color:var(--muted);
      font-size:12px;
      margin:0 0 6px;
    }
    .timeVal{
      font-size:18px;
      font-weight:900;
      margin:0;
      letter-spacing:.3px;
    }

    .duaBox{
      margin-top:12px;
      padding:14px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.04);
      text-align:center;
    }
    .duaTitle{
      margin:0 0 8px;
      color:var(--gold);
      font-weight:900;
      font-size:14px;
    }
    .duaText{
      margin:0;
      color:var(--text);
      font-size:15px;
      line-height:1.9;
      font-weight:700;
    }

    /* ===== Infinite marquee (FIXED - Professional) ===== */
    #marqueeBox{
            direction:ltr; /* Ù…Ù‡Ù…: ÙŠÙ…Ù†Ø¹ ØªÙƒØ±Ø§Ø± Ù†ÙØ³ 3 ØµÙˆØ± Ø¨Ø³Ø¨Ø¨ RTL */
margin-top:12px;
      border-radius:18px;
      border:1px solid rgba(245,196,0,.18);
      background:rgba(255,255,255,.03);
      overflow:hidden;
      position:relative;
    }
    #marqueeTrack{
            direction:ltr; /* Ø§Ø¬Ø¹Ù„ ØªØ±ØªÙŠØ¨ Ø§Ù„ØµÙˆØ± LTR Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø§Ø±ÙƒÙŠ */
/* JS sets --shift and --dur */
      --shift: 800px;
      --dur: 26s;
      display:flex;
      flex-wrap:nowrap;          /* ÙŠÙ…Ù†Ø¹ Ø£ÙŠ ØµÙ Ø«Ø§Ù†ÙŠ */
      gap:12px;
      align-items:center;
      width:max-content;
      padding:10px 12px;
      animation: marqueeScroll var(--dur) linear infinite;
      will-change: transform;
      transform: translateZ(0);
    }
    #marqueeBox:hover #marqueeTrack{animation-play-state:paused;}
    @keyframes marqueeScroll{
      from{ transform: translateX(0); }
      to{ transform: translateX(calc(-1 * var(--shift))); }
    }
    .pic{
      height:120px;
      width:200px;
      border-radius:16px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.18);
      box-shadow:0 10px 28px rgba(0,0,0,.22);
      flex:0 0 auto;
    }
    @media (max-width:520px){
      .pic{height:92px;width:160px}
    }
    .pic img{
      width:100%;height:100%;
      object-fit:cover;
      display:block;
      transform:scale(1.02);
      transition:transform .35s ease;
    }
    .pic:hover img{transform:scale(1.08);}
    #noImagesBox{
      padding:14px 12px;
      text-align:center;
      color:var(--muted);
      display:none;
      font-size:13px;
    }

    /* Social icons row (circles) */
    .socialRow{
      margin-top:14px;
      display:flex;
      justify-content:center;
      gap:12px;
      flex-wrap:wrap;
      opacity:0;
      transform: translateY(8px);
      animation: fadeIn .7s ease forwards;
      animation-delay:.15s;
    }
    @keyframes fadeIn{to{opacity:1; transform: translateY(0);}}
    .socialIcon{
      width:52px;height:52px;
      border-radius:999px;
      display:grid;
      place-items:center;
      border:1px solid rgba(245,196,0,.26);
      background:rgba(245,196,0,.08);
      color:var(--gold2);
      box-shadow: 0 0 0 rgba(245,196,0,0);
      transition: transform .18s ease, box-shadow .22s ease, background .22s ease, border-color .22s ease;
      -webkit-tap-highlight-color: transparent;
      outline:none;
    }
    .socialIcon:hover{
      transform: translateY(-2px) scale(1.03);
      border-color: rgba(245,196,0,.42);
      box-shadow: 0 0 18px rgba(245,196,0,.22), 0 10px 26px rgba(0,0,0,.22);
      background:rgba(245,196,0,.12);
    }
    .socialIcon:active{
      transform: translateY(0) scale(.97);
      box-shadow: 0 0 10px rgba(245,196,0,.16);
    }

    .btnRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-start;
      margin-top:10px;
    }
    .btn{
      cursor:pointer;
      border:1px solid rgba(245,196,0,.26);
      background:rgba(245,196,0,.10);
      color:var(--gold2);
      padding:10px 12px;
      border-radius:14px;
      font-weight:800;
      font-size:13px;
      transition: transform .18s ease, box-shadow .22s ease, background .22s ease;
    }
    .btn:hover{transform: translateY(-1px); box-shadow:0 12px 30px rgba(0,0,0,.25); background:rgba(245,196,0,.14);}
    .btn:active{transform: scale(.98);}

    .fieldRow{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    @media (max-width: 520px){
      .fieldRow{grid-template-columns:1fr}
    }
    label{
      display:block;
      font-size:12px;
      color:var(--muted);
      margin-bottom:6px;
    }
    select{
      width:100%;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.05);
      color:var(--text);
      outline:none;
    }
    select:focus{border-color:rgba(245,196,0,.35); box-shadow:0 0 0 3px rgba(245,196,0,.10);}

    .note{
      margin-top:10px;
      color:var(--muted);
      font-size:12.5px;
      line-height:1.7;
    }

    footer{
      margin-top:14px;
      text-align:center;
      color:var(--text);
      font-weight:900;
      font-size:16px;
      line-height:1.9;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">
          <img src="images/logo.png" alt="Ø­Ù„Ù… Ø¨ÙŠØ±ÙˆØª" onerror="this.style.display='none'">
        </div>
        <div class="titles">
          <h1>ØªÙ‚ÙˆÙŠÙ… Ø±Ù…Ø¶Ø§Ù† â€” Ø­Ù„Ù… Ø¨ÙŠØ±ÙˆØª</h1>
          <p>Ù…Ø°Ø§Ù‚ Ø¨ÙŠØ±ÙˆØª Ø§Ù„Ø£ØµÙŠÙ„ Ø¨Ø£Ø·Ø¨Ø§Ù‚ ÙØ§Ø®Ø±Ø© ÙˆØ£Ø¬ÙˆØ§Ø¡ ØªØ£Ø®Ø°Ùƒ Ø¥Ù„Ù‰ Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ù…ØªÙˆØ³Ø· Â· Ø§Ù„Ø¯ÙˆØ§Ù… 24 Ø³Ø§Ø¹Ø©</p>
        </div>
      </div>
      <div class="pill" id="statusPill">Ø¬Ø§Ù‡Ø²</div>
    </header>

    <div class="grid">
      <section class="card">
        <div class="cardHead">
          <h2>ğŸ“… Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„Ù…ÙˆØ§Ù‚ÙŠØª</h2>
          <button class="btn" id="refreshBtn" type="button">ØªØ­Ø¯ÙŠØ«</button>
        </div>
        <div class="bodyPad">
          <div class="todayBox">
            <p class="todayTitle" id="todayTitle">Ø§Ù„ÙŠÙˆÙ…</p>
            <p class="todayLine">Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ: <strong id="hijriText">â€”</strong></p>
            <p class="todayLine">Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ: <strong id="gregText">â€”</strong></p>
            <p class="bigHijri" id="ramadanDayText">â€”</p>
          </div>

          <div class="timesGrid" aria-label="Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© ÙˆØ§Ù„Ø¥Ù…Ø³Ø§Ùƒ">
            <div class="timeCard"><p class="timeName">Ø§Ù„Ø¥Ù…Ø³Ø§Ùƒ</p><p class="timeVal" id="imsak">â€”</p></div>
            <div class="timeCard"><p class="timeName">Ø§Ù„ÙØ¬Ø±</p><p class="timeVal" id="fajr">â€”</p></div>
            <div class="timeCard"><p class="timeName">Ø§Ù„Ø´Ø±ÙˆÙ‚</p><p class="timeVal" id="sunrise">â€”</p></div>
            <div class="timeCard"><p class="timeName">Ø§Ù„Ø¸Ù‡Ø±</p><p class="timeVal" id="dhuhr">â€”</p></div>
            <div class="timeCard"><p class="timeName">Ø§Ù„Ø¹ØµØ±</p><p class="timeVal" id="asr">â€”</p></div>
            <div class="timeCard"><p class="timeName">Ø§Ù„Ù…ØºØ±Ø¨ (Ø§Ù„Ø¥ÙØ·Ø§Ø±)</p><p class="timeVal" id="maghrib">â€”</p></div>
            <div class="timeCard"><p class="timeName">Ø§Ù„Ø¹Ø´Ø§Ø¡</p><p class="timeVal" id="isha">â€”</p></div>
          </div>

          <div class="duaBox">
            <p class="duaTitle">ğŸ¤² Ø¯Ø¹Ø§Ø¡ Ø§Ù„ÙŠÙˆÙ…</p>
            <p class="duaText" id="duaText">â€”</p>
          </div>

          <div id="marqueeBox" aria-label="ØµÙˆØ± Ù…Ø·Ø¹Ù… Ø­Ù„Ù… Ø¨ÙŠØ±ÙˆØª">
            <div id="marqueeTrack"></div>
            <div id="noImagesBox">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØµÙˆØ± Ø¯Ø§Ø®Ù„ Ù…Ø¬Ù„Ø¯ <b>images</b>.</div>
          </div>

          <div class="socialRow" aria-label="Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªÙˆØ§ØµÙ„">
            <a class="socialIcon" href="https://wa.me/9647701111722" target="_blank" rel="noopener" aria-label="WhatsApp">
              <svg viewBox="0 0 32 32" width="22" height="22" aria-hidden="true">
                <path fill="currentColor" d="M19.11 17.59c-.3-.15-1.77-.87-2.04-.97-.27-.1-.47-.15-.66.15-.2.3-.76.97-.93 1.17-.17.2-.34.22-.64.07-.3-.15-1.25-.46-2.38-1.47-.88-.78-1.48-1.75-1.65-2.05-.17-.3-.02-.46.13-.61.13-.13.3-.34.45-.51.15-.17.2-.3.3-.5.1-.2.05-.38-.03-.53-.08-.15-.66-1.6-.9-2.19-.24-.57-.48-.49-.66-.5h-.56c-.2 0-.53.08-.8.38-.27.3-1.05 1.03-1.05 2.5 0 1.47 1.07 2.9 1.22 3.1.15.2 2.1 3.2 5.08 4.49.71.31 1.27.5 1.7.64.71.23 1.36.2 1.87.12.57-.09 1.77-.72 2.02-1.42.25-.7.25-1.3.17-1.42-.08-.12-.27-.2-.57-.35z"/>
                <path fill="currentColor" d="M16.02 3C9.39 3 4 8.39 4 15.02c0 2.11.55 4.17 1.59 5.99L4 29l8.19-1.54a12 12 0 0 0 3.83.62C22.65 28.08 28 22.65 28 16.02 28 9.39 22.65 3 16.02 3zm0 22.03c-1.22 0-2.41-.23-3.54-.68l-.56-.22-4.85.91.92-4.73-.24-.6a9.95 9.95 0 0 1-1.02-4.39c0-5.53 4.5-10.03 10.03-10.03 5.53 0 10.03 4.5 10.03 10.03 0 5.53-4.5 10.03-10.03 10.03z"/>
              </svg>
            </a>

            <a class="socialIcon" href="https://www.instagram.com/helem.rest?igsh=bHU3azE0dGdseGVv" target="_blank" rel="noopener" aria-label="Instagram">
              <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
                <path fill="currentColor" d="M7.5 2h9A5.5 5.5 0 0 1 22 7.5v9A5.5 5.5 0 0 1 16.5 22h-9A5.5 5.5 0 0 1 2 16.5v-9A5.5 5.5 0 0 1 7.5 2zm0 2A3.5 3.5 0 0 0 4 7.5v9A3.5 3.5 0 0 0 7.5 20h9a3.5 3.5 0 0 0 3.5-3.5v-9A3.5 3.5 0 0 0 16.5 4h-9z"/>
                <path fill="currentColor" d="M12 7a5 5 0 1 1 0 10 5 5 0 0 1 0-10zm0 2a3 3 0 1 0 0 6 3 3 0 0 0 0-6z"/>
                <path fill="currentColor" d="M17.75 6.25a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
              </svg>
            </a>

            <a class="socialIcon" href="https://www.facebook.com/helemrest/" target="_blank" rel="noopener" aria-label="Facebook">
              <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
                <path fill="currentColor" d="M13.5 22v-8h2.7l.4-3H13.5V9.1c0-.9.3-1.6 1.6-1.6H16.7V4.9c-.3 0-1.3-.1-2.5-.1-2.5 0-4.2 1.5-4.2 4.3V11H7.5v3H10v8h3.5z"/>
              </svg>
            </a>
          </div>

          <footer>
            ØªÙ‚Ø¨Ù„ Ø§Ù„Ù„Ù‡ Ù…Ù†Ø§ ÙˆÙ…Ù†ÙƒÙ… ØµØ§Ù„Ø­ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„<br/>
            ÙƒÙ„ Ø¹Ø§Ù… ÙˆØ£Ù†ØªÙ… Ø¨Ø£Ù„Ù Ø®ÙŠØ±
          </footer>
        </div>
      </section>

      <aside class="card">
        <div class="cardHead">
          <h2>âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>
          <span class="pill" id="cityPill">Ø¨ØºØ¯Ø§Ø¯</span>
        </div>
        <div class="bodyPad">
          <div class="fieldRow">
            <div>
              <label for="sectSel">Ø§Ù„Ù…Ø°Ù‡Ø¨</label>
              <select id="sectSel">
                <option value="sunni">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø³Ù†ÙŠ</option>
                <option value="shia">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø´ÙŠØ¹ÙŠ</option>
              </select>
            </div>
            <div>
              <label for="manualOffsetSel">ØªØµØ­ÙŠØ­ ÙŠÙˆÙ… Ø±Ù…Ø¶Ø§Ù†</label>
              <select id="manualOffsetSel">
                <option value="0">0 (Ø¨Ø¯ÙˆÙ† ØªØµØ­ÙŠØ­)</option>
                <option value="1">+1</option>
                <option value="-1">-1</option>
              </select>
            </div>
          </div>

          <div class="btnRow">
            <button class="btn" id="saveBtn" type="button">Ø­ÙØ¸</button>
            <button class="btn" id="resetBtn" type="button">Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·</button>
          </div>

         
        </div>
      </aside>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);

    // âœ… Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„ØµÙˆØ± Ø¹Ù†Ø¯Ùƒ Ø¨Ø§Ù„Ø¶Ø¨Ø· (Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ÙŠ limit = 3)
    const SLIDE_IMAGES = [
      "images/slide1.jpeg",
      "images/slide2.jpeg",
      "images/slide3.jpeg",
      "images/slide4.jpeg",
      "images/slide5.jpeg",
      "images/slide6.jpeg",
      "images/slide7.jpeg",
      "images/slide8.jpeg",
      "images/slide9.jpeg",
      "images/slide10.jpeg",
      "images/slide11.jpeg",
      "images/slide12.jpeg",
      "images/slide13.jpeg",
      "images/slide14.jpeg",
      "images/slide15.jpeg"
    ];

    const STORAGE_KEY = "ramadan_dream_beirut_settings_v1";

    const DEFAULTS = {
      city: "Baghdad",
      country: "Iraq",
      sect: "sunni",
      manualOffset: 0,
    };

    function setStatus(t){ $("statusPill").textContent = t; }

    function loadSettings(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return {...DEFAULTS};
        const x = JSON.parse(raw);
        return {...DEFAULTS, ...x};
      }catch(_){
        return {...DEFAULTS};
      }
    }

    function saveSettings(s){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(s));
    }

    function toAmPm(hhmm){
      if(!hhmm || typeof hhmm !== "string") return "â€”";
      const m = hhmm.match(/^(\d{1,2}):(\d{2})/);
      if(!m) return hhmm;
      let h = parseInt(m[1],10);
      const min = m[2];
      const ampm = (h >= 12) ? "PM" : "AM";
      h = h % 12;
      if(h === 0) h = 12;
      const hh = String(h).padStart(2,"0");
      return `${hh}:${min} ${ampm}`;
    }

    function fmtGreg(d){
      try{
        return new Intl.DateTimeFormat("ar-IQ", {weekday:"long", year:"numeric", month:"long", day:"numeric"}).format(d);
      }catch(_){
        return d.toLocaleDateString();
      }
    }

    function fmtHijri(d){
      try{
        return new Intl.DateTimeFormat("ar-SA-u-ca-islamic", {weekday:"long", year:"numeric", month:"long", day:"numeric"}).format(d);
      }catch(_){
        return "â€”";
      }
    }

    function hijriParts(d){
      try{
        const parts = new Intl.DateTimeFormat("ar-SA-u-ca-islamic", {day:"numeric", month:"long", year:"numeric"}).formatToParts(d);
        const get = (type)=> parts.find(p=>p.type===type)?.value;
        return { day: get("day"), month: get("month"), year: get("year") };
      }catch(_){
        return { day:null, month:null, year:null };
      }
    }

    function setDuaForToday(){
      const DUAS = [
        "Ø§Ù„Ù„Ù‡Ù… Ø§Ø¬Ø¹Ù„ ØµÙŠØ§Ù…Ù†Ø§ ÙÙŠÙ‡ ØµÙŠØ§Ù… Ø§Ù„ØµØ§Ø¦Ù…ÙŠÙ† ÙˆÙ‚ÙŠØ§Ù…Ù†Ø§ ÙÙŠÙ‡ Ù‚ÙŠØ§Ù… Ø§Ù„Ù‚Ø§Ø¦Ù…ÙŠÙ†.",
        "Ø§Ù„Ù„Ù‡Ù… Ø§ØºÙØ± Ù„Ù†Ø§ Ø°Ù†ÙˆØ¨Ù†Ø§ØŒ ÙˆØ§ØµÙ„Ø­ Ù„Ù†Ø§ Ø´Ø£Ù†Ù†Ø§ ÙƒÙ„Ù‡ØŒ ÙˆÙ„Ø§ ØªÙƒÙ„Ù†Ø§ Ø¥Ù„Ù‰ Ø£Ù†ÙØ³Ù†Ø§ Ø·Ø±ÙØ© Ø¹ÙŠÙ†.",
        "Ø§Ù„Ù„Ù‡Ù… Ø§Ø±Ø²Ù‚Ù†Ø§ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø¥Ø®Ù„Ø§Øµ ÙˆØ§Ù„Ù‚Ø¨ÙˆÙ„ØŒ ÙˆØ¨Ù„ØºÙ†Ø§ Ù„ÙŠÙ„Ø© Ø§Ù„Ù‚Ø¯Ø±.",
        "Ø§Ù„Ù„Ù‡Ù… Ø§Ø¬Ø¹Ù„ Ù„Ù†Ø§ Ù…Ù† ÙƒÙ„ Ù‡Ù…Ù ÙØ±Ø¬Ø§Ù‹ ÙˆÙ…Ù† ÙƒÙ„ Ø¶ÙŠÙ‚Ù Ù…Ø®Ø±Ø¬Ø§Ù‹.",
        "Ø§Ù„Ù„Ù‡Ù… Ø§Ø¬Ø¹Ù„ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ… ÙØªØ­Ø§Ù‹ ÙˆØ®ÙŠØ±Ø§Ù‹ ÙˆØ¨Ø±ÙƒØ©Ù‹ Ø¹Ù„ÙŠÙ†Ø§ ÙˆØ¹Ù„Ù‰ Ø£Ù‡Ù„Ù†Ø§."
      ];
      const now = new Date();
      const idx = (now.getFullYear()*10000 + (now.getMonth()+1)*100 + now.getDate()) % DUAS.length;
      $("duaText").textContent = DUAS[idx];
    }

    async function fetchTimings(city, country, sect){
      const method = (sect === "shia") ? 0 : 3;
      const url = `https://api.aladhan.com/v1/timingsByCity?city=${encodeURIComponent(city)}&country=${encodeURIComponent(country)}&method=${method}`;
      const res = await fetch(url, {cache:"no-store"});
      if(!res.ok) throw new Error("API error");
      const js = await res.json();
      if(!js || js.code !== 200) throw new Error("Bad response");
      const t = js.data.timings;
      return { imsak:t.Imsak, fajr:t.Fajr, sunrise:t.Sunrise, dhuhr:t.Dhuhr, asr:t.Asr, maghrib:t.Maghrib, isha:t.Isha };
    }

    function applyTimingToUI(t){
      $("imsak").textContent   = toAmPm(t.imsak);
      $("fajr").textContent    = toAmPm(t.fajr);
      $("sunrise").textContent = toAmPm(t.sunrise);
      $("dhuhr").textContent   = toAmPm(t.dhuhr);
      $("asr").textContent     = toAmPm(t.asr);
      $("maghrib").textContent = toAmPm(t.maghrib);
      $("isha").textContent    = toAmPm(t.isha);
    }

    function updateDatesUI(settings){
      const now = new Date();
      const sectBase = (settings.sect === "shia") ? -1 : 0;
      const deltaDays = sectBase + (parseInt(settings.manualOffset,10) || 0);
      const hijriDate = new Date(now);
      hijriDate.setDate(hijriDate.getDate() + deltaDays);

      $("gregText").textContent = fmtGreg(now);
      $("hijriText").textContent = fmtHijri(hijriDate);

      const hp = hijriParts(hijriDate);
      if(hp.month && (hp.month.includes("Ø±Ù…Ø¶Ø§Ù†") || hp.month.includes("Ø±Ù…Ø¶"))) {
        $("ramadanDayText").textContent = `Ø§Ù„ÙŠÙˆÙ… ${hp.day} Ø±Ù…Ø¶Ø§Ù† ${hp.year} Ù‡Ù€ (${settings.sect === "shia" ? "Ø§Ù„ÙˆÙ‚Ù Ø§Ù„Ø´ÙŠØ¹ÙŠ" : "Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø³Ù†ÙŠ"})`;
      } else {
        $("ramadanDayText").textContent = `(${settings.sect === "shia" ? "Ø§Ù„ÙˆÙ‚Ù Ø§Ù„Ø´ÙŠØ¹ÙŠ" : "Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø³Ù†ÙŠ"})`;
      }

      $("todayTitle").textContent = "Ø§Ù„ÙŠÙˆÙ…";
    }

    // ===== Marquee Engine (Professional / No overlap / Seamless) =====
    // Ø§Ù„ÙÙƒØ±Ø©: Ù†Ù†ØªØ¸Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±ØŒ Ø«Ù… Ù†Ø­Ø³Ø¨ Ø¹Ø±Ø¶ "Ù…Ø¬Ù…ÙˆØ¹Ø© ÙˆØ§Ø­Ø¯Ø©" Ø¨Ø¯Ù‚Ø©ØŒ Ø«Ù… Ù†ÙƒØ±Ø±Ù‡Ø§
    // Ø¨Ø¹Ø¯Ø¯ ÙƒØ§ÙÙŠ Ø­ØªÙ‰ Ù…Ø§ ÙŠØµÙŠØ± ÙØ±Ø§ØºØŒ ÙˆØ¨Ø¹Ø¯Ù‡Ø§ Ù†Ø´ØºÙ„ Ø§Ù„Ø§Ù†ÙŠÙ…ÙŠØ´Ù† Ù…Ø±Ø© ÙˆØ­Ø¯Ø©.
    let marqueeStarted = false;

    function restartMarquee(track){
      track.style.animation = "none";
      void track.offsetHeight;
      track.style.animation = "marqueeScroll var(--dur) linear infinite";
    }

    function waitImg(img, timeoutMs=10000){
      return new Promise((resolve)=>{
        if(img.complete) return resolve(img.naturalWidth > 0);
        let done = false;
        const finish = (ok)=>{ if(done) return; done = true; resolve(ok); };
        const t = setTimeout(()=>finish(false), timeoutMs);
        img.addEventListener("load", ()=>{ clearTimeout(t); finish(true); }, {once:true});
        img.addEventListener("error", ()=>{ clearTimeout(t); finish(false); }, {once:true});
      });
    }

    async function initMarqueeOnce(){
      if(marqueeStarted) return;
      marqueeStarted = true;

      const track = $("marqueeTrack");
      const wrap  = $("marqueeBox");
      const noBox = $("noImagesBox");
      if(!track || !wrap || !noBox) return;

      track.innerHTML = "";
      noBox.style.display = "none";

      // 1) Build ONE set (ÙƒÙ„ Ø§Ù„ØµÙˆØ±)
      for(const src of SLIDE_IMAGES){
        const pic = document.createElement("div");
        pic.className = "pic";
        const img = document.createElement("img");
        img.src = src;
        img.alt = "Ø­Ù„Ù… Ø¨ÙŠØ±ÙˆØª";
        img.loading = "eager";
        pic.appendChild(img);
        track.appendChild(pic);
      }

      // 2) Wait images, remove failed only
      const imgs = Array.from(track.querySelectorAll("img"));
      const ok = await Promise.all(imgs.map(i => waitImg(i)));
      const failed = [];
      for(let i=imgs.length-1;i>=0;i--){
        if(!ok[i]){
          failed.push(imgs[i].src);
          imgs[i].closest(".pic")?.remove();
        }
      }

      const setNodes = Array.from(track.querySelectorAll(".pic"));
      if(setNodes.length === 0){
        noBox.style.display = "block";
        return;
      }

      // Diagnostics (console only)
      console.log("[Marquee] Loaded:", setNodes.length, "Failed:", failed.length);
      if(failed.length) console.log("[Marquee] Failed URLs:", failed);

      // âœ… Ù…Ù‡Ù…: Ø§Ù†ØªØ¸Ø± Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø§Ù„Ø±Ø³Ù…/Ø§Ù„Ù‚ÙŠØ§Ø³Ø§Øª
      await new Promise(r => requestAnimationFrame(() => requestAnimationFrame(r)));

      // 3) Measure one set width accurately (Ø¨Ø¯ÙˆÙ† scrollWidth Ø§Ù„Ù…ØªØ°Ø¨Ø°Ø¨)
      const gap = parseFloat(getComputedStyle(track).gap || "0");
      let oneSetWidth = 0;
      for(const node of setNodes){
        oneSetWidth += node.getBoundingClientRect().width;
      }
      oneSetWidth += gap * (setNodes.length - 1);
      oneSetWidth = Math.ceil(oneSetWidth);

      // 4) Duplicate enough times to avoid gaps on any screen
      // Ù†Ø­ØªØ§Ø¬ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙŠÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø§Ø´Ø© Ø¨ÙƒØ«ÙŠØ± Ø­ØªÙ‰ Ù…Ø§ ÙŠØµÙŠØ± ÙØ±Ø§Øº
      const target = wrap.clientWidth * 3 + oneSetWidth;
      while(track.scrollWidth < target){
        for(const node of setNodes){
          track.appendChild(node.cloneNode(true));
        }
      }

      // 5) Seamless loop: shift = width of ONE set
      track.style.setProperty("--shift", oneSetWidth + "px");

      // 6) Professional constant speed (px/sec)
      const PX_PER_SEC = 28; // Ø¥Ø°Ø§ ØªØ±ÙŠØ¯ Ø£Ø³Ø±Ø¹ Ø®Ù„Ù‘ÙŠÙ‡ 70
      const durSec = Math.max(10, oneSetWidth / PX_PER_SEC);
      track.style.setProperty("--dur", durSec.toFixed(2) + "s");

      // 7) Start animation cleanly
      requestAnimationFrame(()=> restartMarquee(track));

      // Resize: keep same speed feel (duration only) without rebuild
      let raf = null;
      window.addEventListener("resize", ()=>{
        if(raf) cancelAnimationFrame(raf);
        raf = requestAnimationFrame(()=>{
          const newDur = Math.max(10, oneSetWidth / PX_PER_SEC);
          track.style.setProperty("--dur", newDur.toFixed(2) + "s");
          restartMarquee(track);
        });
      }, {passive:true});
    }

    async function render(){
      const settings = loadSettings();
      $("sectSel").value = settings.sect;
      $("manualOffsetSel").value = String(settings.manualOffset ?? 0);
      $("cityPill").textContent = "Ø¨ØºØ¯Ø§Ø¯";

      updateDatesUI(settings);
      setDuaForToday(settings);

      setStatus("Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«â€¦");
      try{
        const t = await fetchTimings(settings.city, settings.country, settings.sect);
        applyTimingToUI(t);
        setStatus("Ø¬Ø§Ù‡Ø²");
      }catch(e){
        console.error(e);
        setStatus("ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«");
      }

      // âœ… Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ÙŠ rebuild Ø¨Ø¹Ø¯ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„
      initMarqueeOnce();
    }

    document.addEventListener("DOMContentLoaded", () => {
      render();
    });

    $("refreshBtn").addEventListener("click", render);

    $("saveBtn").addEventListener("click", () => {
      const s = loadSettings();
      s.sect = $("sectSel").value;
      s.manualOffset = parseInt($("manualOffsetSel").value, 10) || 0;
      saveSettings(s);
      render();
    });

    $("resetBtn").addEventListener("click", () => {
      saveSettings({...DEFAULTS});
      render();
    });
  </script>
</body>
</html>
