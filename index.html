<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ØªÙ‚ÙˆÙŠÙ… Ø±Ù…Ø¶Ø§Ù† â€” Ø­Ù„Ù… Ø¨ÙŠØ±ÙˆØª</title>

  <style>
    :root{
      --bg:#071826;
      --panel:rgba(255,255,255,.06);
      --panel2:rgba(255,255,255,.09);
      --line:rgba(255,255,255,.12);
      --text:#eaf2ff;
      --muted:#b9c7da;
      --gold:#f5c400;
      --gold2:#ffdf55;
      --shadow:0 18px 50px rgba(0,0,0,.35);
      --radius:18px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      background: radial-gradient(1200px 600px at 15% 0%, rgba(245,196,0,.12), transparent 55%),
                  radial-gradient(900px 500px at 85% 10%, rgba(245,196,0,.08), transparent 55%),
                  var(--bg);
      color:var(--text);
      font-family: Arial, sans-serif;
    }

    .wrap{
      max-width:1180px;
      margin: 22px auto 40px;
      padding: 0 14px;
      animation: fadeIn .55s ease both;
    }

    @keyframes fadeIn{
      from{opacity:0; transform: translateY(8px)}
      to{opacity:1; transform: translateY(0)}
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:14px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width: 220px;
    }
    .logo{
      width:54px;
      height:54px;
      border-radius:16px;
      overflow:hidden;
      background: rgba(255,255,255,.04);
      border:1px solid rgba(245,196,0,.25);
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      flex:0 0 auto;
    }
    .logo img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .titleBox h1{
      margin:0;
      font-size:28px;
      color:var(--gold);
      letter-spacing:.3px;
    }
    .titleBox p{
      margin:6px 0 0;
      color:var(--muted);
      font-size:14px;
    }

    .pills{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-start;
    }
    .pill{
      border:1px solid rgba(245,196,0,.25);
      background: rgba(255,255,255,.05);
      padding:8px 12px;
      border-radius: 999px;
      color: var(--text);
      font-size: 13px;
      box-shadow: 0 12px 34px rgba(0,0,0,.22);
    }
    .pill b{color:var(--gold2)}
    .btn{
      cursor:pointer;
      border:none;
      border-radius:999px;
      padding:10px 14px;
      background: rgba(245,196,0,.14);
      color: var(--gold2);
      font-weight:800;
      transition: transform .12s ease, box-shadow .2s ease, background .2s ease;
      border:1px solid rgba(245,196,0,.28);
      box-shadow: 0 10px 24px rgba(0,0,0,.22);
    }
    .btn:hover{
      background: rgba(245,196,0,.18);
      box-shadow: 0 0 0 3px rgba(245,196,0,.08), 0 16px 34px rgba(0,0,0,.28);
      transform: translateY(-1px);
    }
    .btn:active{ transform: translateY(1px) scale(.99); }

    .grid{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:14px;
      margin-top: 14px;
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .cardHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:14px 16px;
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .cardHead h2{
      margin:0;
      font-size:18px;
      color: var(--gold2);
    }

    .cardBody{ padding: 14px 16px 16px; }

    .bigDate{
      border-radius: 16px;
      padding: 16px;
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(245,196,0,.16);
      margin-bottom: 12px;
    }
    .bigDate .line1{ color: var(--muted); font-size: 13px; margin:0 0 6px; }
    .bigDate .hijri{ font-size: 20px; font-weight: 900; margin:0 0 6px; }
    .bigDate .greg{ color: var(--muted); margin:0; font-weight:700; }

    .times{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
      margin-top: 10px;
    }
    .tbox{
      background: rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.08);
      border-radius: 16px;
      padding: 12px;
      text-align:center;
    }
    .tbox .lbl{ color: var(--muted); font-size: 12px; margin-bottom: 6px; }
    .tbox .val{ font-size: 18px; font-weight: 900; color: var(--text); }

    .duaBox{
      margin-top: 12px;
      border-radius: 16px;
      padding: 14px 14px 12px;
      background: rgba(0,0,0,.18);
      border:1px solid rgba(245,196,0,.16);
      position:relative;
    }
    .duaTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom: 8px;
    }
    .duaTop .pillSmall{
      border:1px solid rgba(245,196,0,.22);
      background: rgba(245,196,0,.08);
      color: var(--gold2);
      border-radius: 999px;
      padding: 6px 10px;
      font-weight: 900;
      font-size: 12px;
    }
    .duaText{
      margin:0;
      color: var(--text);
      font-weight: 800;
      line-height: 1.9;
      font-size: 14px;
    }

    /* âœ… Ø³Ù„Ø§ÙŠØ¯Ø± ØµÙˆØ± Ù…Ø³ØªÙ…Ø± */
    .marqueeWrap{
      margin-top: 12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      overflow:hidden;
      position:relative;
    }
    .marquee{
      display:flex;
      align-items:center;
      gap:12px;
      width:max-content;
      padding: 10px 12px;
      animation: scrollX 22s linear infinite;
    }
    .marquee:hover{ animation-play-state: paused; } /* Ø§Ø®ØªÙŠØ§Ø±ÙŠ: ÙŠÙˆÙ‚Ù Ø¹Ù†Ø¯ hover */
    @keyframes scrollX{
      from{ transform: translateX(0); }
      to{ transform: translateX(-50%); }
    }
    .pic{
      width: 190px;
      height: 95px;
      border-radius: 14px;
      overflow:hidden;
      border:1px solid rgba(245,196,0,.18);
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      flex: 0 0 auto;
      background: rgba(255,255,255,.04);
    }
    .pic img{ width:100%; height:100%; object-fit:cover; display:block; }

    .noImages{
      padding: 12px 14px;
      color: var(--muted);
      font-weight: 700;
      text-align:center;
      display:none;
    }

    /* Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ø³ÙˆØ´ÙŠØ§Ù„ */
    .socialRow{
      display:flex;
      gap:12px;
      justify-content:center;
      padding: 16px 0 6px;
      margin-top: 6px;
    }
    .socialIcon{
      width: 54px;
      height: 54px;
      border-radius: 999px;
      display:grid;
      place-items:center;
      text-decoration:none;
      color: var(--gold2);
      background: rgba(0,0,0,.22);
      border:1px solid rgba(245,196,0,.25);
      box-shadow: 0 14px 34px rgba(0,0,0,.26);
      transform: translateY(0);
      transition: transform .14s ease, box-shadow .2s ease, background .2s ease, filter .2s ease;
      animation: fadeIn .55s ease both;
    }
    .socialIcon:hover{
      background: rgba(245,196,0,.10);
      box-shadow: 0 0 0 3px rgba(245,196,0,.08), 0 18px 44px rgba(0,0,0,.32);
      filter: drop-shadow(0 0 14px rgba(245,196,0,.35));
      transform: translateY(-2px);
    }
    .socialIcon:active{
      transform: translateY(1px) scale(.98);
    }

    .bless{
      margin-top: 14px;
      text-align:center;
      font-weight: 900;
      font-size: 16px;
      line-height: 2;
      color: var(--text);
    }

    /* Settings modal */
    .modalWrap{
      position: fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      padding:14px;
      background: rgba(0,0,0,.55);
      z-index: 999;
    }
    .modal{
      width:min(560px, 100%);
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(7,24,38,.98);
      box-shadow: 0 30px 80px rgba(0,0,0,.6);
      overflow:hidden;
    }
    .modal .mHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 14px 16px;
      border-bottom:1px solid rgba(255,255,255,.10);
    }
    .modal .mHead h3{ margin:0; color: var(--gold2); }
    .modal .mBody{ padding: 14px 16px 16px; }
    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-bottom: 10px;
    }
    label{ font-size: 12px; color: var(--muted); font-weight: 800; display:block; margin-bottom: 6px; }
    select,input{
      width:100%;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 11px 12px;
      outline:none;
      font-weight: 800;
    }
    .mActions{
      display:flex;
      gap:10px;
      justify-content:flex-end;
      margin-top: 10px;
    }

    /* responsive */
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
      .titleBox h1{ font-size: 24px; }
      .times{ grid-template-columns: repeat(2, 1fr); }
      .pic{ width: 170px; height: 90px; }
    }
    @media (max-width: 520px){
      .times{ grid-template-columns: 1fr 1fr; }
      .pic{ width: 150px; height: 82px; }
      .socialIcon{ width: 50px; height: 50px; }
      .row{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <div class="wrap">

    <div class="topbar">
      <div class="brand">
        <div class="logo">
          <img src="images/logo.png" alt="Ø­Ù„Ù… Ø¨ÙŠØ±ÙˆØª" onerror="this.style.display='none'">
        </div>
        <div class="titleBox">
          <h1>ØªÙ‚ÙˆÙŠÙ… Ø±Ù…Ø¶Ø§Ù† â€” Ø­Ù„Ù… Ø¨ÙŠØ±ÙˆØª</h1>
          <p>Ù…Ø°Ø§Ù‚ Ø¨ÙŠØ±ÙˆØª Ø§Ù„Ø£ØµÙŠÙ„ Ø¨Ø£Ø·Ø¨Ø§Ù‚ ÙØ§Ø®Ø±Ø© â€” Ø§Ù„Ø¯ÙˆØ§Ù… 24 Ø³Ø§Ø¹Ø©</p>
        </div>
      </div>

      <div class="pills">
        <div class="pill">Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©: <b id="cityPill">Ø¨ØºØ¯Ø§Ø¯</b></div>
        <div class="pill">Ø§Ù„Ø­Ø§Ù„Ø©: <b id="statusPill">Ø¬Ø§Ù‡Ø²</b></div>
        <button class="btn" id="btnRefreshTop">ØªØ­Ø¯ÙŠØ«</button>
        <button class="btn" id="toggleSettings">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
      </div>
    </div>

    <div class="grid">
      <!-- ÙŠØ³Ø§Ø±: Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„Ù…ÙˆØ§Ù‚ÙŠØª -->
      <section class="card">
        <div class="cardHead">
          <h2>Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„Ù…ÙˆØ§Ù‚ÙŠØª</h2>
          <span class="pill">AM/PM</span>
        </div>

        <div class="cardBody">
          <div class="bigDate">
            <p class="line1" id="line1">Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠ</p>
            <p class="hijri" id="hijriLine">â€”</p>
            <p class="greg" id="gregLine">â€”</p>
          </div>

          <div class="times">
            <div class="tbox"><div class="lbl">Ø§Ù„Ø¥Ù…Ø³Ø§Ùƒ</div><div class="val" id="imsak">â€”</div></div>
            <div class="tbox"><div class="lbl">Ø§Ù„ÙØ¬Ø±</div><div class="val" id="fajr">â€”</div></div>
            <div class="tbox"><div class="lbl">Ø§Ù„Ø´Ø±ÙˆÙ‚</div><div class="val" id="sunrise">â€”</div></div>
            <div class="tbox"><div class="lbl">Ø§Ù„Ø¸Ù‡Ø±</div><div class="val" id="dhuhr">â€”</div></div>
            <div class="tbox"><div class="lbl">Ø§Ù„Ø¹ØµØ±</div><div class="val" id="asr">â€”</div></div>
            <div class="tbox"><div class="lbl">Ø§Ù„Ù…ØºØ±Ø¨ (Ø§Ù„Ø¥ÙØ·Ø§Ø±)</div><div class="val" id="maghrib">â€”</div></div>
            <div class="tbox"><div class="lbl">Ø§Ù„Ø¹Ø´Ø§Ø¡</div><div class="val" id="isha">â€”</div></div>
          </div>

          <div class="duaBox">
            <div class="duaTop">
              <span class="pillSmall" id="duaDayPill">Ø¯Ø¹Ø§Ø¡ Ø§Ù„ÙŠÙˆÙ…</span>
              <span class="pillSmall">ğŸ“¿</span>
            </div>
            <p class="duaText" id="duaText">â€”</p>
          </div>

          <!-- âœ… Ø³Ù„Ø§ÙŠØ¯Ø± ØµÙˆØ± Ù…Ø³ØªÙ…Ø± ØªØ­Øª Ø§Ù„Ø¯Ø¹Ø§Ø¡ -->
          <div class="marqueeWrap" id="marqueeBox">
            <div class="marquee" id="marqueeTrack"></div>
            <div class="noImages" id="noImagesBox">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØµÙˆØ± Ø¯Ø§Ø®Ù„ Ù…Ø¬Ù„Ø¯ images</div>
          </div>

          <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„ -->
          <div class="socialRow">
            <a class="socialIcon" href="https://www.facebook.com/helemrest/" target="_blank" rel="noopener" aria-label="Facebook">
              <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
                <path fill="currentColor" d="M13.5 22v-8h2.7l.4-3h-3.1V9.1c0-.9.3-1.5 1.6-1.5H16.7V5c-.3 0-1.4-.1-2.7-.1-2.7 0-4.5 1.6-4.5 4.6V11H7v3h2.5v8h4z"/>
              </svg>
            </a>

            <a class="socialIcon" href="https://www.instagram.com/helem.rest?igsh=bHU3azE0dGdseGVv" target="_blank" rel="noopener" aria-label="Instagram">
              <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
                <path fill="currentColor" d="M7.5 2h9A5.5 5.5 0 0 1 22 7.5v9A5.5 5.5 0 0 1 16.5 22h-9A5.5 5.5 0 0 1 2 16.5v-9A5.5 5.5 0 0 1 7.5 2zm0 2A3.5 3.5 0 0 0 4 7.5v9A3.5 3.5 0 0 0 7.5 20h9a3.5 3.5 0 0 0 3.5-3.5v-9A3.5 3.5 0 0 0 16.5 4h-9z"/>
                <path fill="currentColor" d="M12 7a5 5 0 1 1 0 10 5 5 0 0 1 0-10zm0 2a3 3 0 1 0 0 6 3 3 0 0 0 0-6z"/>
                <path fill="currentColor" d="M17.75 6.25a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
              </svg>
            </a>
          </div>

          <div class="bless">
            ØªÙ‚Ø¨Ù„ Ø§Ù„Ù„Ù‡ Ù…Ù†Ø§ ÙˆÙ…Ù†ÙƒÙ… ØµØ§Ù„Ø­ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„<br/>
            ÙƒÙ„ Ø¹Ø§Ù… ÙˆØ£Ù†ØªÙ… Ø¨Ø£Ù„Ù Ø®ÙŠØ±
          </div>
        </div>
      </section>

      <!-- ÙŠÙ…ÙŠÙ†: Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
      <section class="card">
        <div class="cardHead">
          <h2>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>
          <button class="btn" id="btnToday">Ø§Ù„ÙŠÙˆÙ…</button>
        </div>
        <div class="cardBody">
          <p style="margin:0 0 10px; color:var(--muted); font-weight:800; line-height:1.8">
            Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© ÙˆØ§Ù„Ù…Ø°Ù‡Ø¨. Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± <b style="color:var(--gold2)">Ø§Ù„ÙˆÙ‚Ù Ø§Ù„Ø´ÙŠØ¹ÙŠ</b> ÙŠØªÙ… ØªØ£Ø®ÙŠØ± Ø§Ù„Ù…ØºØ±Ø¨ 15 Ø¯Ù‚ÙŠÙ‚Ø© (ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ Ù„Ù„Ø­Ù…Ø±Ø©).
          </p>

          <div class="row">
            <div>
              <label>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</label>
              <select id="city">
                <option value="Baghdad">Ø¨ØºØ¯Ø§Ø¯</option>
                <option value="Basra">Ø§Ù„Ø¨ØµØ±Ø©</option>
              </select>
            </div>
            <div>
              <label>Ø§Ù„Ù…Ø°Ù‡Ø¨</label>
              <select id="sect">
                <option value="sunni">Ø§Ù„ÙˆÙ‚Ù Ø§Ù„Ø³Ù†ÙŠ</option>
                <option value="shia">Ø§Ù„ÙˆÙ‚Ù Ø§Ù„Ø´ÙŠØ¹ÙŠ</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div>
              <label>Ø§Ø®ØªÙŠØ§Ø± ØªØ§Ø±ÙŠØ® (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
              <input id="date" type="date" />
            </div>
            <div>
              <label>ØªØµØ­ÙŠØ­ ÙŠÙˆÙ… Ø±Ù…Ø¶Ø§Ù† (ÙŠØ¯ÙˆÙŠ)</label>
              <select id="offset">
                <option value="0">0 (Ø¨Ø¯ÙˆÙ† ØªØµØ­ÙŠØ­)</option>
                <option value="1">+1</option>
                <option value="-1">-1</option>
                <option value="2">+2</option>
                <option value="-2">-2</option>
              </select>
            </div>
          </div>

          <div class="mActions">
            <button class="btn" id="btnSave">Ø­ÙØ¸</button>
            <button class="btn" id="btnClose">Ø¥ØºÙ„Ø§Ù‚</button>
          </div>
        </div>
      </section>
    </div>
  </div>

  <!-- Settings modal -->
  <div class="modalWrap" id="settingsModal" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="mHead">
        <h3>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
        <button class="btn" id="btnClose2">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
      <div class="mBody">
        <p style="margin:0; color:var(--muted); font-weight:800; line-height:1.8">
          Ù†ÙØ³ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙŠÙ…ÙŠÙ†. (Ù†Ø§ÙØ°Ø© Ù„Ù„Ù‡ÙˆØ§ØªÙ)
        </p>
      </div>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);

    const DEFAULTS = {
      city: "Baghdad",
      sect: "sunni",
      sectOffsetSunni: 0,
      sectOffsetShia: -1,
      manualOffset: 0
    };

    function setStatus(t){ const el = $("statusPill"); if(el) el.textContent = t; }

    function loadSettings(){
      const saved = JSON.parse(localStorage.getItem("hb_ramadan_settings") || "null");
      $("city").value = saved?.city ?? DEFAULTS.city;
      $("sect").value = saved?.sect ?? DEFAULTS.sect;
      $("offset").value = String(saved?.manualOffset ?? DEFAULTS.manualOffset);
      if (saved?.date) $("date").value = saved.date;
    }
    function saveSettings(){
      const data = {
        city: $("city").value,
        sect: $("sect").value,
        manualOffset: parseInt($("offset").value,10) || 0,
        date: $("date").value || ""
      };
      localStorage.setItem("hb_ramadan_settings", JSON.stringify(data));
    }

    function getBaseDate(){
      const v = $("date").value;
      if (v) return new Date(v + "T00:00:00");
      const now = new Date();
      return new Date(now.getFullYear(), now.getMonth(), now.getDate());
    }
    function addDays(date, days){
      const d = new Date(date);
      d.setDate(d.getDate() + days);
      return d;
    }
    function getDisplayDate(){
      const base = getBaseDate();
      const sect = $("sect").value;
      const manualOffset = parseInt($("offset").value,10) || 0;
      const sectOffset = (sect === "shia") ? DEFAULTS.sectOffsetShia : DEFAULTS.sectOffsetSunni;
      return addDays(base, sectOffset + manualOffset);
    }

    function toAmPm(hhmm){
      if (!hhmm || hhmm === "â€”") return "â€”";
      const m = String(hhmm).match(/^(\d{1,2}):(\d{2})/);
      if(!m) return hhmm;
      let h = parseInt(m[1],10);
      const min = m[2];
      const ampm = (h >= 12) ? "PM" : "AM";
      h = h % 12; if (h === 0) h = 12;
      return `${h}:${min} ${ampm}`;
    }

    function addMinutes(hhmm, mins){
      const m = String(hhmm).match(/^(\d{1,2}):(\d{2})/);
      if(!m) return hhmm;
      let h = parseInt(m[1],10), mm = parseInt(m[2],10);
      let total = h*60 + mm + mins;
      total = (total + 1440) % 1440;
      const nh = String(Math.floor(total/60)).padStart(2,"0");
      const nm = String(total%60).padStart(2,"0");
      return `${nh}:${nm}`;
    }

    async function fetchTimingsAndDates(date, city){
      const d = String(date.getDate()).padStart(2,"0");
      const m = String(date.getMonth()+1).padStart(2,"0");
      const y = String(date.getFullYear());

      const url = `https://api.aladhan.com/v1/timingsByCity/${d}-${m}-${y}?city=${encodeURIComponent(city)}&country=Iraq&method=4`;
      const res = await fetch(url, { cache: "no-store" });
      const json = await res.json();
      const data = json?.data;
      const t = data?.timings || {};
      const clean = (v) => String(v || "").slice(0,5);

      const hijri = data?.date?.hijri;
      const greg  = data?.date?.gregorian;

      const hijriText = hijri
        ? `${hijri.day} ${hijri.month?.ar || hijri.month?.en || ""} ${hijri.year} Ù‡Ù€`
        : "â€”";

      const gregText = greg
        ? `${greg.day} ${greg.month?.en || ""} ${greg.year}`
        : "â€”";

      return {
        timings: {
          imsak: clean(t.Imsak || t.Fajr),
          fajr: clean(t.Fajr),
          sunrise: clean(t.Sunrise),
          dhuhr: clean(t.Dhuhr),
          asr: clean(t.Asr),
          maghrib: clean(t.Maghrib),
          isha: clean(t.Isha),
        },
        hijriText,
        gregText
      };
    }

    const DUAS = [
      "Ø§Ù„Ù„Ù‡Ù… Ø§Ø¬Ø¹Ù„Ù†Ø§ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ… Ù…Ù† Ø§Ù„Ù…Ù‚Ø¨ÙˆÙ„ÙŠÙ†ØŒ ÙˆØ§ØºÙØ± Ù„Ù†Ø§ ÙˆØ§Ø±Ø­Ù…Ù†Ø§ Ø¨Ø±Ø­Ù…ØªÙƒ ÙŠØ§ Ø£Ø±Ø­Ù… Ø§Ù„Ø±Ø§Ø­Ù…ÙŠÙ†.",
      "Ø§Ù„Ù„Ù‡Ù… Ø§Ø±Ø²Ù‚Ù†Ø§ ØµØ¯Ù‚ Ø§Ù„ØªÙˆØ¨Ø© ÙˆØµÙØ§Ø¡ Ø§Ù„Ù‚Ù„Ø¨ ÙˆØ­Ø³Ù† Ø§Ù„Ø®Ø§ØªÙ…Ø©ØŒ ÙˆØ¨Ø§Ø±Ùƒ Ù„Ù†Ø§ ÙÙŠ Ø£Ø¹Ù…Ø§Ù„Ù†Ø§.",
      "Ø§Ù„Ù„Ù‡Ù… Ø§Ø¬Ø¹Ù„ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ… ÙØ±Ø¬Ø§Ù‹ Ù„ÙƒÙ„ Ù…Ù‡Ù…ÙˆÙ… ÙˆØ´ÙØ§Ø¡Ù‹ Ù„ÙƒÙ„ Ù…Ø±ÙŠØ¶ ÙˆØ±Ø²Ù‚Ø§Ù‹ ÙˆØ§Ø³Ø¹Ø§Ù‹ Ù„Ù†Ø§ ÙˆÙ„Ø£Ù‡Ù„Ù†Ø§.",
      "Ø§Ù„Ù„Ù‡Ù… Ø§Ø¬Ø¹Ù„Ù†Ø§ Ù…Ù† Ø£Ù‡Ù„ Ø§Ù„Ù‚Ø±Ø¢Ù† ÙˆÙˆÙÙ‚Ù†Ø§ Ù„Ù‚ÙŠØ§Ù… Ø§Ù„Ù„ÙŠÙ„ ÙˆØ§ØºØ³Ù„ Ù‚Ù„ÙˆØ¨Ù†Ø§ Ù…Ù† ÙƒÙ„ Ù‡Ù…Ù‘ ÙˆØ­Ø²Ù†.",
      "Ø§Ù„Ù„Ù‡Ù… ØªÙ‚Ø¨Ù„ ØµÙŠØ§Ù…Ù†Ø§ ÙˆÙ‚ÙŠØ§Ù…Ù†Ø§ ÙˆØ§Ù‡Ø¯Ù†Ø§ Ù„Ø£Ø­Ø³Ù† Ø§Ù„Ø£Ø®Ù„Ø§Ù‚ Ù„Ø§ ÙŠÙ‡Ø¯ÙŠ Ù„Ø£Ø­Ø³Ù†Ù‡Ø§ Ø¥Ù„Ø§ Ø£Ù†Øª.",
      "Ø§Ù„Ù„Ù‡Ù… Ø§Ø±Ø²Ù‚Ù†Ø§ Ø¨Ø±ÙƒØ© Ø§Ù„ÙˆÙ‚Øª ÙˆÙ†ÙˆØ± Ø§Ù„Ø¨ØµÙŠØ±Ø© ÙˆØ±Ø§Ø­Ø© Ø§Ù„Ø¨Ø§Ù„ ÙˆØ³Ø¹Ø© Ø§Ù„Ø±Ø²Ù‚.",
      "Ø§Ù„Ù„Ù‡Ù… Ø§Ø¬Ø¹Ù„ Ù„Ù†Ø§ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ… Ø¯Ø¹ÙˆØ© Ù„Ø§ ØªÙØ±Ø¯ ÙˆØ§ÙØªØ­ Ù„Ù†Ø§ Ø£Ø¨ÙˆØ§Ø¨ Ø§Ù„Ø®ÙŠØ± Ù…Ù† Ø­ÙŠØ« Ù„Ø§ Ù†Ø­ØªØ³Ø¨.",
      "Ø§Ù„Ù„Ù‡Ù… Ø§Ø­ÙØ¸ Ø£Ù‡Ù„Ù†Ø§ ÙˆØ£ÙˆÙ„Ø§Ø¯Ù†Ø§ ÙˆØ¨Ù„Ø¯Ù†Ø§ ÙˆØ£Ø¯Ù… Ø¹Ù„ÙŠÙ†Ø§ Ø§Ù„Ø£Ù…Ù† ÙˆØ§Ù„Ø¹Ø§ÙÙŠØ© ÙˆØ§Ù„Ø³ØªØ±."
    ];
    function getDuaForDay(){
      const today = new Date();
      const key = today.getDate();
      return DUAS[(key - 1) % DUAS.length];
    }

    // âœ… Ø³Ù„Ø§ÙŠØ¯Ø± Ù…Ø³ØªÙ…Ø±: ÙƒØ±Ø± Ø§Ù„ØµÙˆØ± Ù…Ø±ØªÙŠÙ† Ø­ØªÙ‰ ÙŠØµÙŠØ± loop Ø¨Ø¯ÙˆÙ† Ù†Ù‡Ø§ÙŠØ©
    // Ù…Ù„Ø§Ø­Ø¸Ø©: ØºÙŠÙ‘Ø± Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„ØµÙˆØ± Ø­Ø³Ø¨ Ø§Ù„Ù„ÙŠ Ø±Ø§ÙØ¹Ù‡Ø§ Ø¯Ø§Ø®Ù„ images/
    const SLIDE_IMAGES = [
      "images/slide1.jpg",
      "images/slide2.jpg",
      "images/slide3.jpg",
      "images/slide4.jpg",
      "images/slide5.jpg",
      "images/slide6.jpg",
      "images/slide7.jpg",
      "images/slide8.jpg",
      "images/slide9.jpg",
      "images/slide10.jpg",
      "images/slide11.jpg",
      "images/slide12.jpg",
      "images/slide13.jpg"
    ];

    function preload(src){
      return new Promise((resolve)=>{
        const img = new Image();
        img.onload = ()=>resolve(true);
        img.onerror = ()=>resolve(false);
        img.src = src + "?v=" + Date.now();
      });
    }

    async function buildMarquee(){
      const track = $("marqueeTrack");
      const noBox = $("noImagesBox");
      const wrap  = $("marqueeBox");
      if(!track || !noBox || !wrap) return;

      track.innerHTML = "";
      noBox.style.display = "none";

      const found = [];
      for (const src of SLIDE_IMAGES){
        // eslint-disable-next-line no-await-in-loop
        if (await preload(src)) found.push(src);
      }

      if(found.length === 0){
        noBox.style.display = "block";
        return;
      }

      const loop = found.concat(found);
      for(const src of loop){
        const box = document.createElement("div");
        box.className = "pic";
        const img = document.createElement("img");
        img.src = src;
        img.alt = "Ø­Ù„Ù… Ø¨ÙŠØ±ÙˆØª";
        box.appendChild(img);
        track.appendChild(box);
      }
    }

    function openSettings(){
      $("settingsModal").style.display = "flex";
      $("settingsModal").setAttribute("aria-hidden","false");
    }
    function closeSettings(){
      $("settingsModal").style.display = "none";
      $("settingsModal").setAttribute("aria-hidden","true");
    }

    async function render(){
      setStatus("ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«â€¦");

      const date = getDisplayDate();
      const city = $("city").value;
      const sect = $("sect").value;

      $("cityPill").textContent = (city === "Basra") ? "Ø§Ù„Ø¨ØµØ±Ø©" : "Ø¨ØºØ¯Ø§Ø¯";

      const sectLabel = (sect === "shia") ? "Ø§Ù„ÙˆÙ‚Ù Ø§Ù„Ø´ÙŠØ¹ÙŠ" : "Ø§Ù„ÙˆÙ‚Ù Ø§Ù„Ø³Ù†ÙŠ";
      $("line1").textContent = `Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠ (Ø­Ø³Ø¨ ${sectLabel})`;

      $("duaDayPill").textContent = "Ø¯Ø¹Ø§Ø¡ Ø§Ù„ÙŠÙˆÙ…";
      $("duaText").textContent = getDuaForDay();

      try{
        const out = await fetchTimingsAndDates(date, city);

        $("hijriLine").textContent = out.hijriText;
        $("gregLine").textContent  = out.gregText;

        const t = out.timings;

        // âœ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙˆÙ‚Ù Ø§Ù„Ø´ÙŠØ¹ÙŠ (ØªÙ‚Ø¯ÙŠØ±ÙŠ): Ø§Ù„Ù…ØºØ±Ø¨ +15 Ø¯Ù‚ÙŠÙ‚Ø©ØŒ Ø§Ù„Ø¥Ù…Ø³Ø§Ùƒ -10 Ù…Ù† Ø§Ù„ÙØ¬Ø±
        if (sect === "shia"){
          t.maghrib = addMinutes(t.maghrib, 15);
          t.imsak   = addMinutes(t.fajr, -10);
        }

        $("imsak").textContent   = toAmPm(t.imsak);
        $("fajr").textContent    = toAmPm(t.fajr);
        $("sunrise").textContent = toAmPm(t.sunrise);
        $("dhuhr").textContent   = toAmPm(t.dhuhr);
        $("asr").textContent     = toAmPm(t.asr);
        $("maghrib").textContent = toAmPm(t.maghrib);
        $("isha").textContent    = toAmPm(t.isha);

        setStatus("ØªÙ… âœ…");
        setTimeout(()=>setStatus("Ø¬Ø§Ù‡Ø²"), 900);
      }catch(e){
        console.error(e);
        ["imsak","fajr","sunrise","dhuhr","asr","maghrib","isha"].forEach(id=> $(id).textContent="â€”");
        setStatus("ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª");
      }
    }

    document.addEventListener("DOMContentLoaded", async () => {
      loadSettings();
      closeSettings();
      await buildMarquee();
      await render();
      // Ø¥Ø¹Ø§Ø¯Ø© Ù…Ø­Ø§ÙˆÙ„Ø© Ø®ÙÙŠÙØ© Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ø§Ø®ØªÙØ§Ø¡ Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª
      setTimeout(()=>render(), 450);
    });
    window.addEventListener("pageshow", () => render());

    $("btnRefreshTop").addEventListener("click", render);
    $("toggleSettings").addEventListener("click", openSettings);
    $("btnClose").addEventListener("click", closeSettings);
    $("btnClose2").addEventListener("click", closeSettings);
    $("settingsModal").addEventListener("click", (e)=>{ if(e.target === $("settingsModal")) closeSettings(); });

    $("btnSave").addEventListener("click", ()=>{ saveSettings(); closeSettings(); render(); setStatus("ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…"); });
    $("btnToday").addEventListener("click", ()=>{ $("date").value=""; saveSettings(); render(); });

    $("city").addEventListener("change", ()=>{ saveSettings(); render(); });
    $("sect").addEventListener("change", ()=>{ saveSettings(); render(); });
    $("offset").addEventListener("change", ()=>{ saveSettings(); render(); });
    $("date").addEventListener("change", ()=>{ saveSettings(); render(); });
  </script>
</body>
</html>
