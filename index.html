<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ØªÙ‚ÙˆÙŠÙ… Ø±Ù…Ø¶Ø§Ù† â€“ Ø­Ù„Ù… Ø¨ÙŠØ±ÙˆØª</title>
  <style>
    :root{
      --bg:#071826;
      --panel:rgba(255,255,255,.06);
      --panel2:rgba(255,255,255,.09);
      --line:rgba(255,255,255,.12);
      --text:#eef6ff;
      --muted:#b6c7d6;
      --gold:#f5c400;
      --gold2:#ffdd55;
      --shadow:0 18px 55px rgba(0,0,0,.35);
      --radius:20px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Tahoma, Arial, sans-serif;
      background: radial-gradient(900px 600px at 15% 10%, rgba(245,196,0,.10), transparent 60%),
                  radial-gradient(900px 600px at 90% 15%, rgba(0,255,255,.06), transparent 65%),
                  var(--bg);
      color:var(--text);
      min-height:100vh;
    }
    a{color:inherit}
    .wrap{
      max-width:1100px;
      margin:0 auto;
      padding:18px 14px 26px;
    }
    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:14px;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width:0;
    }
    .logo{
      width:56px;height:56px;border-radius:16px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(245,196,0,.25);
      box-shadow:0 12px 30px rgba(0,0,0,.25);
      overflow:hidden;
      flex:0 0 auto;
    }
    .logo img{width:100%;height:100%;object-fit:cover;display:block}
    .titles{min-width:0}
    .titles h1{
      margin:0;
      font-size:22px;
      line-height:1.2;
      color:var(--gold);
      letter-spacing:.2px;
      text-shadow:0 0 16px rgba(245,196,0,.18);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .titles p{
      margin:4px 0 0;
      color:var(--muted);
      font-size:13.5px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.08fr .92fr;
      gap:14px;
      align-items:start;
    }
    @media (max-width: 920px){
      .grid{grid-template-columns:1fr}
    }

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.04));
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .cardHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:14px 14px 10px;
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .cardHead h2{
      margin:0;
      font-size:16px;
      color:var(--gold);
      display:flex;
      align-items:center;
      gap:8px;
    }
    .pill{
      padding:7px 10px;
      border-radius:999px;
      border:1px solid rgba(245,196,0,.28);
      background:rgba(245,196,0,.10);
      color:var(--gold2);
      font-size:12px;
      user-select:none;
    }
    .bodyPad{padding:14px}

    .todayBox{
      background:linear-gradient(135deg, rgba(245,196,0,.09), rgba(255,255,255,.03));
      border:1px solid rgba(245,196,0,.22);
      border-radius:18px;
      padding:14px;
      margin-bottom:12px;
    }
    .todayTitle{
      margin:0 0 6px;
      font-size:15px;
      font-weight:800;
    }
    .todayLine{
      margin:4px 0;
      color:var(--muted);
      font-size:13.5px;
    }
    .todayLine strong{color:var(--text)}
    .bigHijri{
      margin:8px 0 0;
      font-size:17px;
      font-weight:900;
      color:var(--gold2);
    }

    .timesGrid{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap:10px;
    }
    @media (max-width:520px){
      .timesGrid{grid-template-columns: repeat(2, minmax(0, 1fr));}
    }
    .timeCard{
      background:rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.10);
      border-radius:18px;
      padding:12px 10px;
      text-align:center;
      transition:transform .2s ease, box-shadow .2s ease, border-color .2s ease;
    }
    .timeCard:hover{
      transform:translateY(-2px);
      border-color:rgba(245,196,0,.28);
      box-shadow:0 12px 35px rgba(0,0,0,.25);
    }
    .timeName{
      color:var(--muted);
      font-size:12px;
      margin:0 0 6px;
    }
    .timeVal{
      font-size:18px;
      font-weight:900;
      margin:0;
      letter-spacing:.3px;
    }

    .duaBox{
      margin-top:12px;
      padding:14px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.04);
      text-align:center;
    }
    .duaTitle{
      margin:0 0 8px;
      color:var(--gold);
      font-weight:900;
      font-size:14px;
    }
    .duaText{
      margin:0;
      color:var(--text);
      font-size:15px;
      line-height:1.9;
      font-weight:700;
    }

    /* ===== Infinite marquee ===== */
    #marqueeBox{
      margin-top:12px;
      border-radius:18px;
      border:1px solid rgba(245,196,0,.18);
      background:rgba(255,255,255,.03);
      overflow:hidden;
      position:relative;
    }
    #marqueeTrack{
      --shift: 700px;
      display:flex;
      flex-wrap:nowrap;          /* Ù…Ù‡Ù…: ÙŠÙ…Ù†Ø¹ Ø£ÙŠ ØµÙ Ø«Ø§Ù†ÙŠ */
      gap:12px;
      align-items:center;
      width:max-content;
      padding:10px 12px;
      animation: none;           /* Ù†Ø¨Ø¯Ø£ Ø¨Ø¯ÙˆÙ† Ø­Ø±ÙƒØ© Ù„Ø­Ø¯ Ù…Ø§ Ù†Ø¹Ø±Ù Ø§Ù„Ø´ÙØª */
      will-change: transform;
    }
    #marqueeBox:hover #marqueeTrack{animation-play-state:paused;}
    @keyframes scrollX{
      from{ transform: translateX(0); }
      to{ transform: translateX(calc(-1 * var(--shift))); }
    }
    .pic{
      height:120px;
      width:200px;
      border-radius:16px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.18);
      box-shadow:0 10px 28px rgba(0,0,0,.22);
      flex:0 0 auto;
    }
    @media (max-width:520px){
      .pic{height:92px;width:160px}
    }
    .pic img{
      width:100%;height:100%;
      object-fit:cover;
      display:block;
      transform:scale(1.02);
      transition:transform .35s ease;
    }
    .pic:hover img{transform:scale(1.08);}
    #noImagesBox{
      padding:14px 12px;
      text-align:center;
      color:var(--muted);
      display:none;
      font-size:13px;
    }

    /* Social icons row (circles) */
    .socialRow{
      margin-top:14px;
      display:flex;
      justify-content:center;
      gap:12px;
      flex-wrap:wrap;
      opacity:0;
      transform: translateY(8px);
      animation: fadeIn .7s ease forwards;
      animation-delay:.15s;
    }
    @keyframes fadeIn{to{opacity:1; transform: translateY(0);}}
    .socialIcon{
      width:52px;height:52px;
      border-radius:999px;
      display:grid;
      place-items:center;
      border:1px solid rgba(245,196,0,.26);
      background:rgba(245,196,0,.08);
      color:var(--gold2);
      box-shadow: 0 0 0 rgba(245,196,0,0);
      transition: transform .18s ease, box-shadow .22s ease, background .22s ease, border-color .22s ease;
      -webkit-tap-highlight-color: transparent;
      outline:none;
    }
    .socialIcon:hover{
      transform: translateY(-2px) scale(1.03);
      border-color: rgba(245,196,0,.42);
      box-shadow: 0 0 18px rgba(245,196,0,.22), 0 10px 26px rgba(0,0,0,.22);
      background:rgba(245,196,0,.12);
    }
    .socialIcon:active{
      transform: translateY(0) scale(.97);
      box-shadow: 0 0 10px rgba(245,196,0,.16);
    }

    .btnRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-start;
      margin-top:10px;
    }
    .btn{
      cursor:pointer;
      border:1px solid rgba(245,196,0,.26);
      background:rgba(245,196,0,.10);
      color:var(--gold2);
      padding:10px 12px;
      border-radius:14px;
      font-weight:800;
      font-size:13px;
      transition: transform .18s ease, box-shadow .22s ease, background .22s ease;
    }
    .btn:hover{transform: translateY(-1px); box-shadow:0 12px 30px rgba(0,0,0,.25); background:rgba(245,196,0,.14);}
    .btn:active{transform: scale(.98);}

    .fieldRow{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    @media (max-width: 520px){
      .fieldRow{grid-template-columns:1fr}
    }
    label{
      display:block;
      font-size:12px;
      color:var(--muted);
      margin-bottom:6px;
    }
    select{
      width:100%;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.05);
      color:var(--text);
      outline:none;
    }
    select:focus{border-color:rgba(245,196,0,.35); box-shadow:0 0 0 3px rgba(245,196,0,.10);}

    .note{
      margin-top:10px;
      color:var(--muted);
      font-size:12.5px;
      line-height:1.7;
    }

    footer{
      margin-top:14px;
      text-align:center;
      color:var(--text);
      font-weight:900;
      font-size:16px;
      line-height:1.9;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">
          <img src="images/logo.png" alt="Ø­Ù„Ù… Ø¨ÙŠØ±ÙˆØª" onerror="this.style.display='none'">
        </div>
        <div class="titles">
          <h1>ØªÙ‚ÙˆÙŠÙ… Ø±Ù…Ø¶Ø§Ù† â€” Ø­Ù„Ù… Ø¨ÙŠØ±ÙˆØª</h1>
          <p>Ù…Ø°Ø§Ù‚ Ø¨ÙŠØ±ÙˆØª Ø§Ù„Ø£ØµÙŠÙ„ Ø¨Ø£Ø·Ø¨Ø§Ù‚ ÙØ§Ø®Ø±Ø© ÙˆØ£Ø¬ÙˆØ§Ø¡ ØªØ£Ø®Ø°Ùƒ Ø¥Ù„Ù‰ Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ù…ØªÙˆØ³Ø· Â· Ø§Ù„Ø¯ÙˆØ§Ù… 24 Ø³Ø§Ø¹Ø©</p>
        </div>
      </div>
      <div class="pill" id="statusPill">Ø¬Ø§Ù‡Ø²</div>
    </header>

    <div class="grid">
      <section class="card">
        <div class="cardHead">
          <h2>ğŸ“… Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„Ù…ÙˆØ§Ù‚ÙŠØª</h2>
          <button class="btn" id="refreshBtn" type="button">ØªØ­Ø¯ÙŠØ«</button>
        </div>
        <div class="bodyPad">
          <div class="todayBox">
            <p class="todayTitle" id="todayTitle">Ø§Ù„ÙŠÙˆÙ…</p>
            <p class="todayLine">Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ: <strong id="hijriText">â€”</strong></p>
            <p class="todayLine">Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ: <strong id="gregText">â€”</strong></p>
            <p class="bigHijri" id="ramadanDayText">â€”</p>
          </div>

          <div class="timesGrid" aria-label="Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© ÙˆØ§Ù„Ø¥Ù…Ø³Ø§Ùƒ">
            <div class="timeCard"><p class="timeName">Ø§Ù„Ø¥Ù…Ø³Ø§Ùƒ</p><p class="timeVal" id="imsak">â€”</p></div>
            <div class="timeCard"><p class="timeName">Ø§Ù„ÙØ¬Ø±</p><p class="timeVal" id="fajr">â€”</p></div>
            <div class="timeCard"><p class="timeName">Ø§Ù„Ø´Ø±ÙˆÙ‚</p><p class="timeVal" id="sunrise">â€”</p></div>
            <div class="timeCard"><p class="timeName">Ø§Ù„Ø¸Ù‡Ø±</p><p class="timeVal" id="dhuhr">â€”</p></div>
            <div class="timeCard"><p class="timeName">Ø§Ù„Ø¹ØµØ±</p><p class="timeVal" id="asr">â€”</p></div>
            <div class="timeCard"><p class="timeName">Ø§Ù„Ù…ØºØ±Ø¨ (Ø§Ù„Ø¥ÙØ·Ø§Ø±)</p><p class="timeVal" id="maghrib">â€”</p></div>
            <div class="timeCard"><p class="timeName">Ø§Ù„Ø¹Ø´Ø§Ø¡</p><p class="timeVal" id="isha">â€”</p></div>
          </div>

          <div class="duaBox">
            <p class="duaTitle">ğŸ¤² Ø¯Ø¹Ø§Ø¡ Ø§Ù„ÙŠÙˆÙ…</p>
            <p class="duaText" id="duaText">â€”</p>
          </div>

          <div id="marqueeBox" aria-label="ØµÙˆØ± Ù…Ø·Ø¹Ù… Ø­Ù„Ù… Ø¨ÙŠØ±ÙˆØª">
            <div id="marqueeTrack"></div>
            <div id="noImagesBox">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØµÙˆØ± Ø¯Ø§Ø®Ù„ Ù…Ø¬Ù„Ø¯ <b>images</b>.</div>
          </div>

          <div class="socialRow" aria-label="Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªÙˆØ§ØµÙ„">
            <a class="socialIcon" href="https://wa.me/9647701111722" target="_blank" rel="noopener" aria-label="WhatsApp">W</a>
            <a class="socialIcon" href="https://www.instagram.com/helem.rest?igsh=bHU3azE0dGdseGVv" target="_blank" rel="noopener" aria-label="Instagram">I</a>
            <a class="socialIcon" href="https://www.facebook.com/helemrest/" target="_blank" rel="noopener" aria-label="Facebook">F</a>
          </div>

          <footer>
            ØªÙ‚Ø¨Ù„ Ø§Ù„Ù„Ù‡ Ù…Ù†Ø§ ÙˆÙ…Ù†ÙƒÙ… ØµØ§Ù„Ø­ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„<br/>
            ÙƒÙ„ Ø¹Ø§Ù… ÙˆØ£Ù†ØªÙ… Ø¨Ø£Ù„Ù Ø®ÙŠØ±
          </footer>
        </div>
      </section>

      <aside class="card">
        <div class="cardHead">
          <h2>âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>
          <span class="pill" id="cityPill">Ø¨ØºØ¯Ø§Ø¯</span>
        </div>
        <div class="bodyPad">
          <div class="fieldRow">
            <div>
              <label for="sectSel">Ø§Ù„Ù…Ø°Ù‡Ø¨</label>
              <select id="sectSel">
                <option value="sunni">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø³Ù†ÙŠ</option>
                <option value="shia">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø´ÙŠØ¹ÙŠ</option>
              </select>
            </div>
            <div>
              <label for="manualOffsetSel">ØªØµØ­ÙŠØ­ ÙŠÙˆÙ… Ø±Ù…Ø¶Ø§Ù†</label>
              <select id="manualOffsetSel">
                <option value="0">0 (Ø¨Ø¯ÙˆÙ† ØªØµØ­ÙŠØ­)</option>
                <option value="1">+1</option>
                <option value="-1">-1</option>
              </select>
            </div>
          </div>

          <div class="btnRow">
            <button class="btn" id="saveBtn" type="button">Ø­ÙØ¸</button>
            <button class="btn" id="resetBtn" type="button">Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·</button>
          </div>

          <p class="note">
            â€¢ Ø§Ù„Ù…ØµØ¯Ø±: API AlAdhan Ù„Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© (Ø­Ø³Ø¨ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø­Ø³Ø§Ø¨).<br/>
            â€¢ â€œØ§Ù„ÙˆÙ‚Øª Ø§Ù„Ø´ÙŠØ¹ÙŠâ€ Ù‡Ù†Ø§ ÙŠØ¹ØªÙ…Ø¯ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ Ø±Ù‚Ù… <b>0</b> (Jafari / Shia Ithnaâ€‘Ashari) ÙÙŠ AlAdhan.<br/>
          </p>
        </div>
      </aside>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);

    // ========= Ø§Ù„ØµÙˆØ±: Ø¯Ø¹Ù… slide1..slide30 Ù…Ø¹ Ø§Ø­ØªÙ…Ø§Ù„Ø§Øª Ø£Ø³Ù…Ø§Ø¡ =========
    // Ù…Ù„Ø§Ø­Ø¸Ø© Ù…Ù‡Ù…Ø©: Ù„Ø§Ø²Ù… Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ù„ÙØ§Øª ØªØ·Ø§Ø¨Ù‚ Ø¨Ø§Ù„Ø¶Ø¨Ø· (GitHub Ø­Ø³Ø§Ø³ Ù„Ø­Ø±ÙˆÙ ÙƒØ¨ÙŠØ±Ø©/ØµØºÙŠØ±Ø©)
    const SLIDE_IMAGES = [
  "images/slide1.jpeg",
  "images/slide2.jpeg",
  "images/slide3.jpeg",
  "images/slide4.jpeg",
  "images/slide5.jpeg",
  "images/slide6.jpeg",
  "images/slide7.jpeg",
  "images/slide8.jpeg",
  "images/slide9.jpeg",
  "images/slide10.jpeg",
  "images/slide11.jpeg",
  "images/slide12.jpeg",
  "images/slide13.jpeg",
  "images/slide14.jpeg",
  "images/slide15.jpeg"
];

    const STORAGE_KEY = "ramadan_dream_beirut_settings_v1";

    const DEFAULTS = {
      city: "Baghdad",
      country: "Iraq",
      sect: "sunni",
      manualOffset: 0,
    };

    function setStatus(t){ $("statusPill").textContent = t; }

    function loadSettings(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return {...DEFAULTS};
        const x = JSON.parse(raw);
        return {...DEFAULTS, ...x};
      }catch(_){
        return {...DEFAULTS};
      }
    }

    function saveSettings(s){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(s));
    }

    function toAmPm(hhmm){
      if(!hhmm || typeof hhmm !== "string") return "â€”";
      const m = hhmm.match(/^(\d{1,2}):(\d{2})/);
      if(!m) return hhmm;
      let h = parseInt(m[1],10);
      const min = m[2];
      const ampm = (h >= 12) ? "PM" : "AM";
      h = h % 12;
      if(h === 0) h = 12;
      const hh = String(h).padStart(2,"0");
      return `${hh}:${min} ${ampm}`;
    }

    function fmtGreg(d){
      try{
        return new Intl.DateTimeFormat("ar-IQ", {weekday:"long", year:"numeric", month:"long", day:"numeric"}).format(d);
      }catch(_){
        return d.toLocaleDateString();
      }
    }

    function fmtHijri(d){
      try{
        return new Intl.DateTimeFormat("ar-SA-u-ca-islamic", {weekday:"long", year:"numeric", month:"long", day:"numeric"}).format(d);
      }catch(_){
        return "â€”";
      }
    }

    function hijriParts(d){
      try{
        const parts = new Intl.DateTimeFormat("ar-SA-u-ca-islamic", {day:"numeric", month:"long", year:"numeric"}).formatToParts(d);
        const get = (type)=> parts.find(p=>p.type===type)?.value;
        return { day: get("day"), month: get("month"), year: get("year") };
      }catch(_){
        return { day:null, month:null, year:null };
      }
    }

    function setDuaForToday(){
      const DUAS = [
        "Ø§Ù„Ù„Ù‡Ù… Ø§Ø¬Ø¹Ù„ ØµÙŠØ§Ù…Ù†Ø§ ÙÙŠÙ‡ ØµÙŠØ§Ù… Ø§Ù„ØµØ§Ø¦Ù…ÙŠÙ† ÙˆÙ‚ÙŠØ§Ù…Ù†Ø§ ÙÙŠÙ‡ Ù‚ÙŠØ§Ù… Ø§Ù„Ù‚Ø§Ø¦Ù…ÙŠÙ†.",
        "Ø§Ù„Ù„Ù‡Ù… Ø§ØºÙØ± Ù„Ù†Ø§ Ø°Ù†ÙˆØ¨Ù†Ø§ØŒ ÙˆØ§ØµÙ„Ø­ Ù„Ù†Ø§ Ø´Ø£Ù†Ù†Ø§ ÙƒÙ„Ù‡ØŒ ÙˆÙ„Ø§ ØªÙƒÙ„Ù†Ø§ Ø¥Ù„Ù‰ Ø£Ù†ÙØ³Ù†Ø§ Ø·Ø±ÙØ© Ø¹ÙŠÙ†.",
        "Ø§Ù„Ù„Ù‡Ù… Ø§Ø±Ø²Ù‚Ù†Ø§ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø¥Ø®Ù„Ø§Øµ ÙˆØ§Ù„Ù‚Ø¨ÙˆÙ„ØŒ ÙˆØ¨Ù„ØºÙ†Ø§ Ù„ÙŠÙ„Ø© Ø§Ù„Ù‚Ø¯Ø±.",
        "Ø§Ù„Ù„Ù‡Ù… Ø§Ø¬Ø¹Ù„ Ù„Ù†Ø§ Ù…Ù† ÙƒÙ„ Ù‡Ù…Ù ÙØ±Ø¬Ø§Ù‹ ÙˆÙ…Ù† ÙƒÙ„ Ø¶ÙŠÙ‚Ù Ù…Ø®Ø±Ø¬Ø§Ù‹.",
        "Ø§Ù„Ù„Ù‡Ù… Ø§Ø¬Ø¹Ù„ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ… ÙØªØ­Ø§Ù‹ ÙˆØ®ÙŠØ±Ø§Ù‹ ÙˆØ¨Ø±ÙƒØ©Ù‹ Ø¹Ù„ÙŠÙ†Ø§ ÙˆØ¹Ù„Ù‰ Ø£Ù‡Ù„Ù†Ø§."
      ];
      const now = new Date();
      const idx = (now.getFullYear()*10000 + (now.getMonth()+1)*100 + now.getDate()) % DUAS.length;
      $("duaText").textContent = DUAS[idx];
    }

    async function fetchTimings(city, country, sect){
      const method = (sect === "shia") ? 0 : 3;
      const url = `https://api.aladhan.com/v1/timingsByCity?city=${encodeURIComponent(city)}&country=${encodeURIComponent(country)}&method=${method}`;
      const res = await fetch(url, {cache:"no-store"});
      if(!res.ok) throw new Error("API error");
      const js = await res.json();
      if(!js || js.code !== 200) throw new Error("Bad response");
      const t = js.data.timings;
      return { imsak:t.Imsak, fajr:t.Fajr, sunrise:t.Sunrise, dhuhr:t.Dhuhr, asr:t.Asr, maghrib:t.Maghrib, isha:t.Isha };
    }

    function applyTimingToUI(t){
      $("imsak").textContent   = toAmPm(t.imsak);
      $("fajr").textContent    = toAmPm(t.fajr);
      $("sunrise").textContent = toAmPm(t.sunrise);
      $("dhuhr").textContent   = toAmPm(t.dhuhr);
      $("asr").textContent     = toAmPm(t.asr);
      $("maghrib").textContent = toAmPm(t.maghrib);
      $("isha").textContent    = toAmPm(t.isha);
    }

    function updateDatesUI(settings){
      const now = new Date();
      const sectBase = (settings.sect === "shia") ? -1 : 0;
      const deltaDays = sectBase + (parseInt(settings.manualOffset,10) || 0);
      const hijriDate = new Date(now);
      hijriDate.setDate(hijriDate.getDate() + deltaDays);

      $("gregText").textContent = fmtGreg(now);
      $("hijriText").textContent = fmtHijri(hijriDate);

      const hp = hijriParts(hijriDate);
      if(hp.month && (hp.month.includes("Ø±Ù…Ø¶Ø§Ù†") || hp.month.includes("Ø±Ù…Ø¶"))) {
        $("ramadanDayText").textContent = `Ø§Ù„ÙŠÙˆÙ… ${hp.day} Ø±Ù…Ø¶Ø§Ù† ${hp.year} Ù‡Ù€ (${settings.sect === "shia" ? "Ø§Ù„ÙˆÙ‚Ù Ø§Ù„Ø´ÙŠØ¹ÙŠ" : "Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø³Ù†ÙŠ"})`;
      } else {
        $("ramadanDayText").textContent = `(${settings.sect === "shia" ? "Ø§Ù„ÙˆÙ‚Ù Ø§Ù„Ø´ÙŠØ¹ÙŠ" : "Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø³Ù†ÙŠ"})`;
      }
      $("todayTitle").textContent = "Ø§Ù„ÙŠÙˆÙ…";
    }

    // ========= Marquee (Ø«Ø§Ø¨Øª + Ø¨Ø¯ÙˆÙ† Ø£ÙŠ Ø­Ø±ÙƒØ§Øª Ù…ØªØ¯Ø§Ø®Ù„Ø©) =========
    let marqueeInitDone = false;

    function restartAnim(track){
      track.style.animation = "none";
      void track.offsetHeight;
      track.style.animation = "scrollX 26s linear infinite";
    }

    function preload(src, timeoutMs=3500){
      return new Promise((resolve)=>{
        const img = new Image();
        let done = false;
        const finish = (ok)=>{
          if(done) return;
          done = true;
          resolve(ok ? src : null);
        };
        const t = setTimeout(()=>finish(false), timeoutMs);
        img.onload = ()=>{ clearTimeout(t); finish(true); };
        img.onerror = ()=>{ clearTimeout(t); finish(false); };
        img.src = src;
      });
    }

    async function initMarqueeOnce(){
      if(marqueeInitDone) return;
      marqueeInitDone = true;

      const track = $("marqueeTrack");
      const noBox = $("noImagesBox");
      const wrap  = $("marqueeBox");
      if(!track || !noBox || !wrap) return;

      track.innerHTML = "";
      noBox.style.display = "none";

      // Ø¬Ø±Ù‘Ø¨ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ± Ø¨Ø´ÙƒÙ„ Ø³Ø±ÙŠØ¹ØŒ ÙˆØ®Ø° Ø§Ù„Ù„ÙŠ ÙŠÙ†Ø¬Ø­ ÙÙ‚Ø·
      const unique = Array.from(new Set(SLIDE_IMAGES));
      const results = await Promise.all(unique.map(s => preload(s)));
      const loaded = results.filter(Boolean);

      if(loaded.length === 0){
        noBox.style.display = "block";
        return;
      }

      // Ø§Ø¨Ù†ÙŠ Ù†Ø³Ø®Ø© Ø£ÙˆÙ„Ù‰
      const makePic = (src)=>{
        const pic = document.createElement("div");
        pic.className = "pic";
        const img = document.createElement("img");
        img.src = src;
        img.alt = "Ø­Ù„Ù… Ø¨ÙŠØ±ÙˆØª";
        img.loading = "eager";
        pic.appendChild(img);
        return pic;
      };

      for(const src of loaded){
        track.appendChild(makePic(src));
      }

      // Ø§Ù†Ø³Ø®Ù‡Ø§ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ© (Ù†Ø³Ø®ØªÙŠÙ† ÙÙ‚Ø· = Ù„ÙˆØ¨ Ù†Ø§Ø¹Ù…)
      const firstSet = Array.from(track.children);
      for(const node of firstSet){
        track.appendChild(node.cloneNode(true));
      }

      // Ø§Ø­Ø³Ø¨ Ø§Ù„Ø´ÙØª = Ø¹Ø±Ø¶ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
      requestAnimationFrame(()=>{
        const shift = track.scrollWidth / 2;
        track.style.setProperty("--shift", shift + "px");
        restartAnim(track);
      });
    }

    async function render(){
      const settings = loadSettings();
      $("sectSel").value = settings.sect;
      $("manualOffsetSel").value = String(settings.manualOffset ?? 0);
      $("cityPill").textContent = "Ø¨ØºØ¯Ø§Ø¯";

      updateDatesUI(settings);
      setDuaForToday();

      setStatus("Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«â€¦");
      try{
        const t = await fetchTimings(settings.city, settings.country, settings.sect);
        applyTimingToUI(t);
        setStatus("Ø¬Ø§Ù‡Ø²");
      }catch(e){
        console.error(e);
        setStatus("ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«");
      }

      // Ù„Ø§ ØªØ¹ÙŠØ¯ Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø± ÙƒÙ„ Ù…Ø±Ø© â€” Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·
      initMarqueeOnce();
    }

    document.addEventListener("DOMContentLoaded", () => {
      render();
    });

    $("refreshBtn").addEventListener("click", render);

    $("saveBtn").addEventListener("click", () => {
      const s = loadSettings();
      s.sect = $("sectSel").value;
      s.manualOffset = parseInt($("manualOffsetSel").value, 10) || 0;
      saveSettings(s);
      render();
    });

    $("resetBtn").addEventListener("click", () => {
      saveSettings({...DEFAULTS});
      render();
    });
  </script>
</body>
</html>
