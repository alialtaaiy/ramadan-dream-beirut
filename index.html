<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ØªÙ‚ÙˆÙŠÙ… Ø±Ù…Ø¶Ø§Ù† â€” Ø­Ù„Ù… Ø¨ÙŠØ±ÙˆØª</title>
  <link rel="icon" href="logo.png">

  <style>
    :root{
      --bg:#071826;
      --card:#0e2a3f;
      --gold:#f5c400;
      --text:#eaf2ff;
      --muted:#b9c7da;
      --line:rgba(255,255,255,.12);
      --shadow: 0 18px 50px rgba(0,0,0,.35);
      --radius:18px;
    }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Tahoma, Arial, sans-serif;
      background: radial-gradient(1200px 600px at 50% 0%, #0e3a55 0%, var(--bg) 55%);
      color:var(--text);
      padding: 22px;
    }
    .wrap{ max-width: 980px; margin: 0 auto; }
    .top{
      display:flex; align-items:center; justify-content:space-between;
      gap:14px; margin-bottom: 16px;
      flex-wrap: wrap;
    }
    .brand{ display:flex; align-items:center; gap:14px; }
    .logo{
      width:72px; height:72px; border-radius:16px;
      background: linear-gradient(135deg, rgba(245,196,0,.25), rgba(255,255,255,.06));
      display:flex; align-items:center; justify-content:center;
      overflow:hidden; border:1px solid var(--line);
      flex: 0 0 auto;
    }
    .logo img{ width:100%; height:100%; object-fit:cover; display:block; }
    .title h1{ margin:0; font-size: 26px; color: var(--gold); letter-spacing:.2px; }
    .title p{ margin:6px 0 0; color: var(--muted); font-size: 14px; }

    .actions{
      display:flex; gap:10px; align-items:center; flex-wrap: wrap;
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(245,196,0,.12);
      border: 1px solid rgba(245,196,0,.30);
      color: var(--gold);
      font-size: 12px;
      white-space:nowrap;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 16px;
    }
    @media (max-width: 900px){
      .grid{ grid-template-columns: 1fr; }
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid var(--line);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      overflow:hidden;
    }
    .cardHeader{
      padding: 14px 16px;
      background: rgba(0,0,0,.18);
      border-bottom: 1px solid var(--line);
      display:flex; align-items:center; justify-content:space-between; gap: 10px;
    }
    .cardHeader h2{
      margin:0; font-size: 16px; color: var(--gold);
      display:flex; align-items:center; gap:8px;
    }
    .cardBody{ padding: 16px; }

    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 520px){
      .row{ grid-template-columns: 1fr; }
    }

    label{ display:block; font-size: 13px; color: var(--muted); margin-bottom: 6px; }
    select, input, button{
      width:100%;
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid var(--line);
      background: rgba(0,0,0,.22);
      color: var(--text);
      outline:none;
      font-size: 14px;
    }
    input[type="number"]{ direction:ltr; text-align:left; }

    .hint{ font-size: 12px; color: var(--muted); margin-top: 6px; line-height:1.5; }

    .big{
      background: linear-gradient(180deg, rgba(245,196,0,.16), rgba(0,0,0,.20));
      border: 1px solid rgba(245,196,0,.35);
      border-radius: 16px;
      padding: 14px;
      display:grid;
      gap: 8px;
    }
    .big .k{ color: var(--muted); font-size: 12px; }
    .big .v{ font-size: 18px; font-weight: 800; }
    .big .vGold{ color: var(--gold); }

    .times{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
      margin-top: 12px;
    }
    @media (max-width: 720px){
      .times{ grid-template-columns: 1fr 1fr; }
    }
    .t{
      background: rgba(0,0,0,.22);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 12px;
    }
    .t .name{ color: var(--muted); font-size: 12px; }
    .t .val{ font-size: 16px; font-weight: 800; margin-top: 6px; }

    .btns{ display:grid; gap:10px; margin-top: 12px; }
    .btn{
      display:block; text-decoration:none;
      background: var(--gold);
      color:#071826;
      font-weight: 900;
      border-radius: 14px;
      padding: 12px;
      text-align:center;
      border: 0;
    }
    .btn.secondary{
      background: rgba(245,196,0,.12);
      color: var(--gold);
      border: 1px solid rgba(245,196,0,.35);
      font-weight: 800;
    }

    .footerNote{
      margin-top: 12px;
      font-size: 12px;
      color: var(--muted);
      line-height:1.6;
    }

    /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª */
    .modalWrap{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 16px;
      z-index: 999;
    }
    .modal{
      width: min(920px, 100%);
      max-height: 90vh;
      overflow:auto;
      border-radius: 18px;
      border: 1px solid var(--line);
      background: linear-gradient(180deg, rgba(14,42,63,.98), rgba(7,24,38,.98));
      box-shadow: var(--shadow);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div class="logo" title="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø·Ø¹Ù…">
          <img src="logo.png" alt="Logo"
               onerror="this.remove(); this.parentElement.textContent='HB'; this.parentElement.style.color='#f5c400'; this.parentElement.style.fontWeight='900';"/>
        </div>
        <div class="title">
          <h1>ØªÙ‚ÙˆÙŠÙ… Ø±Ù…Ø¶Ø§Ù† â€” Ø­Ù„Ù… Ø¨ÙŠØ±ÙˆØª</h1>
          <p>Ù…Ø°Ø§Ù‚ Ø¨ÙŠØ±ÙˆØª Ø§Ù„Ø£ØµÙŠÙ„ Ø¨Ø£Ø·Ø¨Ø§Ù‚ ÙØ§Ø®Ø±Ø© ÙˆØ£Ø¬ÙˆØ§Ø¡ ØªØ£Ø®Ø°Ùƒ Ø¥Ù„Ù‰ Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ù…ØªÙˆØ³Ø· â€¢ Ø§Ù„Ø¯ÙˆØ§Ù… 24 Ø³Ø§Ø¹Ø©</p>
        </div>
      </div>

      <div class="actions">
        <button id="toggleSettings" class="btn secondary" style="width:auto;padding:10px 12px;">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
        <button id="btnRefreshTop" class="btn secondary" style="width:auto;padding:10px 12px;">ØªØ­Ø¯ÙŠØ«</button>
        <div class="pill" id="statusPill">Ø¬Ø§Ù‡Ø²</div>
      </div>
    </div>

    <div class="grid">
      <!-- Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„Ù…ÙˆØ§Ù‚ÙŠØª -->
      <div class="card">
        <div class="cardHeader">
          <h2>ğŸ•Œ Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„Ù…ÙˆØ§Ù‚ÙŠØª</h2>
          <button id="btnToday" class="btn secondary" style="width:auto;padding:10px 12px;">Ø§Ù„ÙŠÙˆÙ…</button>
        </div>
        <div class="cardBody">
          <div class="big">
            <div class="k">Ø§Ù„ÙŠÙˆÙ…</div>
            <div class="v" id="line1">â€”</div>
            <div class="k">Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ</div>
            <div class="v vGold" id="hijriLine">â€”</div>
            <div class="k">Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ</div>
            <div class="v" id="gregLine">â€”</div>
          </div>

          <div class="times">
            <div class="t"><div class="name">Ø§Ù„Ø¥Ù…Ø³Ø§Ùƒ</div><div class="val" id="imsak">â€”</div></div>
            <div class="t"><div class="name">Ø§Ù„ÙØ¬Ø±</div><div class="val" id="fajr">â€”</div></div>
            <div class="t"><div class="name">Ø§Ù„Ø´Ø±ÙˆÙ‚</div><div class="val" id="sunrise">â€”</div></div>
            <div class="t"><div class="name">Ø§Ù„Ø¸Ù‡Ø±</div><div class="val" id="dhuhr">â€”</div></div>
            <div class="t"><div class="name">Ø§Ù„Ø¹ØµØ±</div><div class="val" id="asr">â€”</div></div>
            <div class="t"><div class="name">Ø§Ù„Ù…ØºØ±Ø¨ (Ø§Ù„Ø¥ÙØ·Ø§Ø±)</div><div class="val" id="maghrib">â€”</div></div>
            <div class="t"><div class="name">Ø§Ù„Ø¹Ø´Ø§Ø¡</div><div class="val" id="isha">â€”</div></div>
          </div>

          <div class="btns">
            <a class="btn" href="https://www.facebook.com/helemrest/" target="_blank" rel="noopener">Facebook</a>
            <a class="btn" href="https://www.instagram.com/helem.rest?igsh=bHU3azE0dGdseGVv" target="_blank" rel="noopener">Instagram</a>
            <a class="btn" href="https://wa.me/9647701111722" target="_blank" rel="noopener">ğŸ“ ÙˆØ§ØªØ³Ø§Ø¨: +964 770 111 1722</a>
            <a class="btn" href="https://wa.me/9647801111722" target="_blank" rel="noopener">ğŸ“ ÙˆØ§ØªØ³Ø§Ø¨: +964 780 111 1722</a>
            <a class="btn secondary" href="#" id="mapBtn">ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹: Ø§Ù„ÙŠØ±Ù…ÙˆÙƒ â€“ 4 Ø´ÙˆØ§Ø±Ø¹</a>
          </div>

          <div class="footerNote">
            Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‚Ø¯ ØªØ®ØªÙ„Ù Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø´Ù‡Ø± Ø­Ø³Ø¨ Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø´Ø±Ø¹ÙŠØ©. Ù„Ø°Ù„Ùƒ ÙŠÙˆØ¬Ø¯ Ø®ÙŠØ§Ø± â€œØªØµØ­ÙŠØ­ Â±1â€.
          </div>
        </div>
      </div>

      <!-- Ø¨Ø·Ø§Ù‚Ø© ØµØºÙŠØ±Ø© Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© -->
      <div class="card">
        <div class="cardHeader">
          <h2>â„¹ï¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</h2>
        </div>
        <div class="cardBody">
          <div class="footerNote">
            â€¢ Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª ÙŠØªÙ… Ø¬Ù„Ø¨Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„Ù…Ø¯ÙŠÙ†Ø© Ø¨ØºØ¯Ø§Ø¯/Ø§Ù„Ø¨ØµØ±Ø© Ù…Ù† Ù…ØµØ¯Ø± Ù…Ø¬Ø§Ù†ÙŠ. <br>
            â€¢ Ø¹Ù†Ø¯ ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆÙ‚Ù Ø§Ù„Ø³Ù†ÙŠ/Ø§Ù„Ø´ÙŠØ¹ÙŠ ÙŠØªÙ… ØªØºÙŠÙŠØ± â€œØªØ§Ø±ÙŠØ® Ø§Ù„Ø¹Ø±Ø¶â€ Ù†ÙØ³Ù‡ØŒ Ù„Ø°Ù„Ùƒ ÙŠØªØºÙŠØ± Ø§Ù„Ù‡Ø¬Ø±ÙŠ ÙˆØ§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ ÙˆØ§Ù„Ù…ÙˆØ§Ù‚ÙŠØª Ø¨Ø´ÙƒÙ„ Ù…ØªØ·Ø§Ø¨Ù‚. <br>
            â€¢ Ø¥Ø°Ø§ Ø¹Ù†Ø¯Ùƒ Ø±Ø§Ø¨Ø· Google Maps Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù„Ù„Ù…ÙˆÙ‚Ø¹ØŒ Ø£Ø±Ø³Ù„Ù‡ ÙˆØ£Ø¶Ø¹Ù‡ Ø¨Ø¯Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡.
          </div>
          <div class="footerNote" style="margin-top:14px;">
            ØªØ±ÙŠØ¯ Ø¥Ø¶Ø§ÙØ©: ØªÙ‚ÙˆÙŠÙ… 30 ÙŠÙˆÙ… Ù…Ø«Ù„ Ø§Ù„Ù…Ø«Ø§Ù„ + Ø¯Ø¹Ø§Ø¡ Ø§Ù„ÙŠÙˆÙ… + Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙØ­Ø©ØŸ Ù‚ÙˆÙ„ÙŠ ÙˆØ£Ø¶ÙŠÙÙ‡Ø§.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª (Ù…Ø®ÙÙŠØ© Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹) -->
  <div class="modalWrap" id="settingsModal" aria-hidden="true">
    <div class="modal card">
      <div class="cardHeader">
        <h2>âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>
        <div style="display:flex; gap:10px;">
          <button id="btnSave" class="btn secondary" style="width:auto;padding:10px 12px;">Ø­ÙØ¸</button>
          <button id="btnClose" class="btn secondary" style="width:auto;padding:10px 12px;">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
      </div>
      <div class="cardBody">
        <div class="row">
          <div>
            <label>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</label>
            <select id="city">
              <option value="Baghdad">Ø¨ØºØ¯Ø§Ø¯</option>
              <option value="Basra">Ø§Ù„Ø¨ØµØ±Ø©</option>
            </select>
            <div class="hint">Ø­Ø§Ù„ÙŠÙ‹Ø§ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚: â€œØ¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚â€. Ù„Ø§Ø­Ù‚Ù‹Ø§ Ù†Ø¶ÙŠÙ Ù…Ù†Ø§Ø·Ù‚ ØªÙØµÙŠÙ„ÙŠØ©.</div>
          </div>

          <div>
            <label>Ø§Ù„Ù…Ø°Ù‡Ø¨</label>
            <select id="sect">
              <option value="sunni">Ø§Ù„ÙˆÙ‚Ù Ø§Ù„Ø³Ù†ÙŠ</option>
              <option value="shia">Ø§Ù„ÙˆÙ‚Ù Ø§Ù„Ø´ÙŠØ¹ÙŠ</option>
            </select>
            <div class="hint">Ø¨Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ Ø¹Ù†Ø¯Ùƒ: Ø§Ù„Ø³Ù†ÙŠ ÙŠØ³Ø¨Ù‚ Ø§Ù„Ø´ÙŠØ¹ÙŠ Ø¨ÙŠÙˆÙ… (Ø§Ù„Ø³Ù†ÙŠ 7 ÙˆØ§Ù„Ø´ÙŠØ¹ÙŠ 6).</div>
          </div>

          <div>
            <label>ØªØµØ­ÙŠØ­ (Â±1 ÙŠÙˆÙ…)</label>
            <select id="offset">
              <option value="0">0 (Ø¨Ø¯ÙˆÙ† ØªØµØ­ÙŠØ­)</option>
              <option value="1">+1 ÙŠÙˆÙ…</option>
              <option value="-1">-1 ÙŠÙˆÙ…</option>
            </select>
            <div class="hint">Ø§Ù„ØªØµØ­ÙŠØ­ ÙŠØºÙŠÙ‘Ø± ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¹Ø±Ø¶ØŒ ÙˆØ¨Ø§Ù„ØªØ§Ù„ÙŠ ÙŠØºÙŠÙ‘Ø± Ø§Ù„Ù‡Ø¬Ø±ÙŠ + Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ + Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª Ù…Ø¹Ø§Ù‹.</div>
          </div>

          <div>
            <label>Ø§Ø®ØªØ± ØªØ§Ø±ÙŠØ® (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <input id="date" type="date"/>
            <div class="hint">Ø¥Ø°Ø§ Ø®Ù„ÙŠØªÙ‡ ÙØ§Ø±ØºØŒ ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.</div>
          </div>
        </div>

        <div class="footerNote">
          âœ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ: Ø¨ØºØ¯Ø§Ø¯. (Ø£ÙˆÙ„ Ù…Ø±Ø©) Ø«Ù… ÙŠØ­ÙØ¸ Ø¢Ø®Ø± Ø§Ø®ØªÙŠØ§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹. <br>
          âœ… Ø¥Ø°Ø§ ØªØ±ÙŠØ¯ â€œØ¯Ø§Ø¦Ù…Ø§Ù‹ Ø¨ØºØ¯Ø§Ø¯â€ Ù‚Ù„Ù‘ÙŠ ÙˆØ£Ø¹Ø¯Ù‘Ù„Ù‡Ø§ Ù„Ùƒ.
        </div>
      </div>
    </div>
  </div>

<script>
  const $ = (id) => document.getElementById(id);

  const DEFAULTS = {
    city: "Baghdad",
    sect: "sunni",
    // Ø­Ø³Ø¨ ÙˆØµÙÙƒ: Ø§Ù„Ø´ÙŠØ¹ÙŠ Ø£Ù‚Ù„ Ø¨ÙŠÙˆÙ… Ø¹Ø§Ø¯Ø©Ù‹
    sectOffsetSunni: 0,
    sectOffsetShia: -1,
    manualOffset: 0
  };

  function setStatus(text){ $("statusPill").textContent = text; }

  function loadSettings(){
    const saved = JSON.parse(localStorage.getItem("hb_ramadan_settings") || "null");

    // Ø¨ØºØ¯Ø§Ø¯ Ø§ÙØªØ±Ø§Ø¶ÙŠ (Ø£ÙˆÙ„ Ù…Ø±Ø©)ØŒ ÙˆØ¨Ø¹Ø¯Ù‡Ø§ ÙŠØ±Ø¬Ø¹ Ø¢Ø®Ø± Ø§Ø®ØªÙŠØ§Ø± Ù…Ø­ÙÙˆØ¸
    $("city").value = (saved && saved.city) ? saved.city : DEFAULTS.city;

    $("sect").value = (saved && saved.sect) ? saved.sect : DEFAULTS.sect;
    $("offset").value = String((saved && typeof saved.manualOffset === "number") ? saved.manualOffset : DEFAULTS.manualOffset);
    if (saved?.date) $("date").value = saved.date;
  }

  function saveSettings(){
    const data = {
      city: $("city").value,
      sect: $("sect").value,
      manualOffset: parseInt($("offset").value,10) || 0,
      date: $("date").value || ""
    };
    localStorage.setItem("hb_ramadan_settings", JSON.stringify(data));
    setStatus("ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…");
    setTimeout(()=>setStatus("Ø¬Ø§Ù‡Ø²"), 1200);
  }

  function getBaseDate(){
    const v = $("date").value;
    if (v) return new Date(v + "T00:00:00");
    const now = new Date();
    return new Date(now.getFullYear(), now.getMonth(), now.getDate());
  }

  function addDays(date, days){
    const d = new Date(date);
    d.setDate(d.getDate() + days);
    return d;
  }

  // ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¹Ø±Ø¶ ÙŠØªØºÙŠØ± Ù…Ø¹ Ø§Ù„ÙˆÙ‚Ù + Ø§Ù„ØªØµØ­ÙŠØ­
  function getDisplayDate(){
    const base = getBaseDate();
    const sect = $("sect").value;
    const manualOffset = parseInt($("offset").value,10) || 0;
    const sectOffset = (sect === "shia") ? DEFAULTS.sectOffsetShia : DEFAULTS.sectOffsetSunni;
    return addDays(base, sectOffset + manualOffset);
  }

  function getIslamicParts(date){
    const fmt = new Intl.DateTimeFormat("ar-IQ-u-ca-islamic", {
      day:"numeric", month:"numeric", year:"numeric"
    });
    const parts = fmt.formatToParts(date);
    const get = (t) => parts.find(p=>p.type===t)?.value;
    const toEn = (s) => String(s)
      .replace(/[Ù -Ù©]/g, d => "Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©".indexOf(d))
      .replace(/[Û°-Û¹]/g, d => "Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹".indexOf(d));

    return {
      day: parseInt(toEn(get("day")),10),
      month: parseInt(toEn(get("month")),10),
      year: parseInt(toEn(get("year")),10),
      rawText: fmt.format(date)
    };
  }

  function formatGregorian(date){
    return new Intl.DateTimeFormat("ar-IQ", { weekday:"long", year:"numeric", month:"long", day:"numeric" }).format(date);
  }

  // Ø§Ù„ÙŠÙˆÙ… Ù…Ù† Ø±Ù…Ø¶Ø§Ù† (ÙÙ‚Ø· Ø¥Ø°Ø§ Ø§Ù„Ø´Ù‡Ø± Ø±Ù…Ø¶Ø§Ù† = 9)
  function getRamadanDay(isl){
    if (isl.month !== 9) return null;
    return isl.day; // Ø¨Ù…Ø§ Ø¥Ù† displayDate ØªØºÙŠÙ‘Ø±ØŒ Ø§Ù„ÙŠÙˆÙ… ÙŠØ·Ø§Ø¨Ù‚ Ø§Ù„ÙˆÙ‚Ù ÙØ¹Ù„Ø§Ù‹
  }

  async function fetchTimings(date, city){
    const d = String(date.getDate()).padStart(2,"0");
    const m = String(date.getMonth()+1).padStart(2,"0");
    const y = String(date.getFullYear());
    const method = 4;
    const url = `https://api.aladhan.com/v1/timingsByCity/${d}-${m}-${y}?city=${encodeURIComponent(city)}&country=Iraq&method=${method}`;
    const res = await fetch(url);
    if(!res.ok) throw new Error("API error");
    const json = await res.json();
    if(!json?.data?.timings) throw new Error("Bad response");
    const t = json.data.timings;
    const clean = (v) => String(v).slice(0,5);
    return {
      imsak: clean(t.Imsak || t.Fajr),
      fajr: clean(t.Fajr),
      sunrise: clean(t.Sunrise),
      dhuhr: clean(t.Dhuhr),
      asr: clean(t.Asr),
      maghrib: clean(t.Maghrib),
      isha: clean(t.Isha)
    };
  }

  async function render(){
    setStatus("ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«â€¦");

    const date = getDisplayDate();
    const city = $("city").value;
    const sect = $("sect").value;

    const isl = getIslamicParts(date);
    const ramDay = getRamadanDay(isl);

    const sectLabel = (sect === "shia") ? "Ø§Ù„ÙˆÙ‚Ù Ø§Ù„Ø´ÙŠØ¹ÙŠ" : "Ø§Ù„ÙˆÙ‚Ù Ø§Ù„Ø³Ù†ÙŠ";
    const line1 = ramDay
      ? `Ø§Ù„ÙŠÙˆÙ… ${ramDay} Ø±Ù…Ø¶Ø§Ù† ${isl.year} Ù‡Ù€ (${sectLabel})`
      : `Ù„ÙŠØ³ Ø¶Ù…Ù† Ø´Ù‡Ø± Ø±Ù…Ø¶Ø§Ù† Ø­Ø§Ù„ÙŠØ§Ù‹ (Ø­Ø³Ø¨ Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠ)`;

    $("line1").textContent = line1;
    $("hijriLine").textContent = isl.rawText;
    $("gregLine").textContent = formatGregorian(date);

    try{
      const timings = await fetchTimings(date, city);
      $("imsak").textContent   = timings.imsak;
      $("fajr").textContent    = timings.fajr;
      $("sunrise").textContent = timings.sunrise;
      $("dhuhr").textContent   = timings.dhuhr;
      $("asr").textContent     = timings.asr;
      $("maghrib").textContent = timings.maghrib;
      $("isha").textContent    = timings.isha;

      setStatus("ØªÙ… âœ…");
      setTimeout(()=>setStatus("Ø¬Ø§Ù‡Ø²"), 1200);
    }catch(e){
      $("imsak").textContent   = "â€”";
      $("fajr").textContent    = "â€”";
      $("sunrise").textContent = "â€”";
      $("dhuhr").textContent   = "â€”";
      $("asr").textContent     = "â€”";
      $("maghrib").textContent = "â€”";
      $("isha").textContent    = "â€”";
      setStatus("ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª");
    }
  }

  // Ø®Ø±ÙŠØ·Ø© (Ø­Ø§Ù„ÙŠØ§Ù‹ ØªÙ†Ø¨ÙŠÙ‡)
  $("mapBtn").addEventListener("click", (e)=>{
    e.preventDefault();
    alert("Ø§Ù„Ù…ÙˆÙ‚Ø¹: Ø§Ù„ÙŠØ±Ù…ÙˆÙƒ â€“ 4 Ø´ÙˆØ§Ø±Ø¹\nØ¥Ø°Ø§ ØªØ±Ø³Ù„ Ø±Ø§Ø¨Ø· Google Maps Ø£Ø¶ÙŠÙÙ‡ ÙƒØ²Ø± ÙŠÙØªØ­ Ø§Ù„Ø®Ø±Ø§Ø¦Ø· Ù…Ø¨Ø§Ø´Ø±Ø©.");
  });

  // ===== Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª =====
  function openSettings(){
    $("settingsModal").style.display = "flex";
    $("settingsModal").setAttribute("aria-hidden","false");
  }
  function closeSettings(){
    $("settingsModal").style.display = "none";
    $("settingsModal").setAttribute("aria-hidden","true");
  }
  $("toggleSettings").addEventListener("click", openSettings);
  $("btnClose").addEventListener("click", closeSettings);
  $("settingsModal").addEventListener("click", (e)=>{
    if (e.target === $("settingsModal")) closeSettings();
  });

  // Ø£Ø²Ø±Ø§Ø±
  $("btnSave").addEventListener("click", ()=>{ saveSettings(); closeSettings(); render(); });
  $("btnRefreshTop").addEventListener("click", render);

  $("btnToday").addEventListener("click", ()=>{
    $("date").value = "";
    saveSettings();
    render();
  });

  // ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†Ø§ÙØ°Ø©
  $("city").addEventListener("change", render);
  $("sect").addEventListener("change", render);
  $("offset").addEventListener("change", render);
  $("date").addEventListener("change", render);

  loadSettings();
  closeSettings(); // Ù…Ø®ÙÙŠØ© Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
  render();
</script>
</body>
</html>
